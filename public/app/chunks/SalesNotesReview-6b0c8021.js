import{q as ee,v as te,A as ae,B as q,e as o,k as le,r as M,o as u,c as Q,h as r,i as z,t as k,a as s,u as l,l as h,w as p,x as se,F,s as S,j as K,p as oe,y as re}from"../entry/index-2642604b.js";import{u as ie}from"./OrdersApiService-1d57fad5.js";import{a as w,s as i,b as E}from"./tag.esm-2b216c36.js";import{_ as de}from"./DialogReportProblem-0aad407c.js";import{s as G}from"./multiselect.esm-5438b66b.js";import"./index.esm-581aa1cb.js";const ne={class:"px-8"},ce={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},ue=r("i",{class:"pi pi-inbox !text-xl"},null,-1),pe=r("div",{class:"flex align-center mb-2"},null,-1),me={class:"flex"},ve={class:"card flex justify-content-center"},be={class:"card flex justify-content-center"},fe={class:"mini-table mt-8"},he={class:"mt-8 flex float-right"},ye=r("div",{class:"space"},null,-1),Ne={__name:"SalesNotesReview",setup(_e){const H=ee(),J=te(),y=ie(),N=ae(),_=q(()=>N.params.id),I=q(()=>N.params.responsible),m=o([]),V=o([]),c=o([]),b=o([]),f=o([]),v=o(!1),R=o(!0),d=o([]),O=o([]),P=o([]),$=o([]),A=o([]),B=o([]),L=new Set,g=new Set,W=new Set;le(async()=>{m.value=await y.showOrder(_.value),c.value=m.value.order_items;let e={update_status:!0,responsible:I.value};await y.updateOrder(_.value,e)});const U=(e,t)=>{const n=W.add(e);if(e.id){const C=t==="complete"?L.add(e):L.delete(e);t==="complete"?(g.delete(e),d.value=Array.from(g)):B.value=e.problems,b.value[e.id]=t==="complete",f.value[e.id]=t!=="complete",v.value=t!=="complete",V.value=t!=="complete"?e:null,P.value=Array.from(n),R.value=P.value.length!==c.value.length,O.value=Array.from(C)}},X=({value:e,tempSelection:t})=>{e||(v.value=v.visibleReport,d.value=t)},Y=e=>{e.product.problems=d.value;let t=g.add(e.product);d.value=Array.from(t)},Z=async()=>{H.require({message:"¿Estas seguro que deseas continuar?",header:"Confirmación",icon:"pi pi-exclamation-triangle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",acceptLabel:"Si",rejectLabel:"No",accept:async()=>{let e=O.value.length==c.value.length,t={orderId:_.value,isSuccessOrder:e,responsible:I.value,orderItemsProblem:d.value??[]},n=await y.processOrderPickerAndReviewer(t);n.status=="success"&&(J.add({severity:n.status,summary:"",detail:n.message,life:3e3}),setTimeout(()=>{window.location.href="/app/autorizador/pickeo-revision"},1e3))},reject:()=>{}})};return(e,t)=>{var j,T;const n=M("router-link"),C=M("Toast");return u(),Q(F,null,[r("div",ne,[r("h1",ce,[ue,z(" Nota de venta N° "+k(m.value.DocNum)+" ",1),s(l(w),{icon:"pi pi-shopping-cart",value:(j=m.value.method_shipping)==null?void 0:j.name,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),pe,s(l(w),{icon:"pi pi-user",value:(T=m.value.customer)==null?void 0:T.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),r("div",me,[r("div",ve,[(u(),h(l(G),{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=a=>$.value=a),options:c.value,filter:"",optionLabel:"Quantity",placeholder:"Cantidad",display:"chip",maxSelectedLabels:3,class:"w-full md:w-20rem",style:{border:"none","max-width":"300px"},key:e.DocNum},null,8,["modelValue","options"]))]),r("div",be,[(u(),h(l(G),{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=a=>A.value=a),options:c.value,filter:"",optionLabel:"ItemCode",placeholder:"SKU",display:"chip",maxSelectedLabels:3,class:"w-full md:w-20rem",style:{border:"none","max-width":"300px"},key:e.DocDate},null,8,["modelValue","options"]))])]),s(l(E),{tableStyle:"min-width: 50rem",filters:"filters",value:c.value},{default:p(()=>[s(l(i),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:p(a=>[r("p",null,k(a.data.qty)+" "+k(a.data.Quantity),1)]),_:1}),s(l(i),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),s(l(i),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),s(l(i),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),s(l(i),{headerClass:"!bg-primary-900",field:"id",header:""},{body:p(a=>[s(l(S),{icon:"pi pi-check-circle",onClick:x=>U(a.data,"complete"),label:"Completado",class:K({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5":b.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!b.value[a.data.id]}),outlined:!b.value[a.data.id]},null,8,["onClick","class","outlined"]),s(l(S),{icon:"pi pi-info-circle rotate-180",onClick:x=>U(a.data,"problem"),label:"Problema",class:K({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5":f.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!f.value[a.data.id]}),outlined:!f.value[a.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),r("div",fe,[d.value.length>0?(u(),h(l(E),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:d.value,class:"teble-probelm"},{default:p(()=>[s(l(i),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),s(l(i),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),s(l(i),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:p(a=>[(u(!0),Q(F,null,oe(a.data.problems,(x,D)=>(u(),h(l(w),{key:D,value:x.title,rounded:"",class:"mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):se("",!0)]),r("div",he,[s(n,{to:{name:"pickup-review"},class:"mr-3 p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},{default:p(()=>[z("Cancelar")]),_:1}),s(l(S),{onClick:Z,label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:R.value},null,8,["disabled"])])]),ye,s(de,{visible:v.value,"onUpdate:visible":t[2]||(t[2]=a=>v.value=a),product:V.value,problemsProduct:B.value,typeProblems:"picker-revisor",onSelectionChange:Y,onVisibleReport:X},null,8,["visible","product","problemsProduct"]),s(C),s(l(re))],64)}}};export{Ne as default};
