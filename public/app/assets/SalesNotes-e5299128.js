import{s as F,a as q}from"./tabpanel.esm-13bde570.js";import{c as v,T as j,_ as Q}from"./ToastMixin-c28ca18a.js";import{e as c,o as l,k as b,w as _,h as r,i as S,t as w,u as e,a as o,c as C,F as E,l as V,s as I,m as U,p as f,q as K,v as T,f as Y,r as W,x as J}from"./index-2ff39bf6.js";import{a as R,b as A,s as h}from"./tag.esm-d257837d.js";import{u as H}from"./ordersCda-d13ae4ed.js";import{u as X,s as Z}from"./ProblemsApiService-8a971cbb.js";import{_ as ee}from"./FilterMultiSelect-16b9898c.js";import{C as te}from"./ConfirmMixin-0865f642.js";import"./index.esm-19c2b8ff.js";import"./OrdersApiService-58ab7571.js";import"./ApiService-9f1aa0f5.js";import"./index.esm-ec338b1a.js";import"./index-dd28ee9b.js";const re=r("h1",{class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-eye !text-xl"}),S(" Ver Documentos ")],-1),ae={class:"flex align-center mb-2"},se={class:"text-primary-900"},oe=r("strong",{class:"mr-3 font-semibold"},"Nota de venta N°",-1),le={class:"mt-5"},ne=r("p",null," 2 archivos adjuntos ",-1),ie={class:"flex"},de={class:"mt-2 mr-5 relative",width:"200",height:"180"},ue=["src"],ce={class:"bg-gray-100"},pe=r("i",{class:"pi pi-file-pdf m-2",style:{color:"#F40F02"}},null,-1),me={class:"font-normal text-sm"},_e=["href"],ge={__name:"DialogDetail",setup(x){const d=H(),t=c([{name:"Documento 1",url:"http://ocw.uv.es/ingenieria-y-arquitectura/programacionmultimedia/t2-1-css.pdf"},{name:"Documento 2",url:"http://ocw.uv.es/ingenieria-y-arquitectura/programacionmultimedia/t2-1-css.pdf"}]);return(p,i)=>(l(),b(e(U),{modal:"",header:" ",style:{width:"70vw"},maximizable:""},{default:_(()=>[r("div",null,[re,r("div",ae,[r("p",se,[oe,S(w(e(d).order.DocNum),1)]),o(e(R),{icon:"pi pi-shopping-bag",value:e(d).order.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),o(e(R),{icon:"pi pi-user",value:e(d).order.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]),r("div",le,[ne,r("div",ie,[(l(!0),C(E,null,V(t.value,a=>(l(),C("div",de,[r("embed",{class:"w-full",src:a.url,type:"application/pdf"},null,8,ue),r("div",ce,[pe,r("span",me,w(a.name),1)]),r("a",{class:"mask-pdf",href:a.url,target:"_blank"},null,8,_e)]))),256))])])]),o(e(I),{label:"Cerrar",onClick:i[0]||(i[0]=a=>e(d).showDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]),_:1}))}},be=r("h1",{class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-eye !text-xl"}),S(" Ver observaciones ")],-1),he={class:"flex align-center mb-2"},ve={class:"text-primary-900"},fe=r("strong",{class:"mr-3 font-semibold"},"Nota de venta N°",-1),ye=["innerHTML"],Pe={class:"mt-5"},Oe=r("strong",null,"NOTA:",-1),De=r("br",null,null,-1),Ce=["innerHTML"],xe={__name:"DialogDetailObservation",setup(x){const d=H(),t=i=>new DOMParser().parseFromString(i,"text/html").body.innerText,p=i=>i.replace(/\r/g,"<br>").replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");return(i,a)=>(l(),b(e(U),{modal:"",header:" ",style:{width:"70vw"},maximizable:""},{default:_(()=>{var m,y;return[r("div",null,[be,r("div",he,[r("p",ve,[fe,S(w(e(d).order.DocNum),1)]),o(e(R),{icon:"pi pi-shopping-cart",value:e(d).order.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),o(e(R),{icon:"pi pi-user",value:e(d).order.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),e(d).order.HasProblems?f("",!0):(l(),b(e(A),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:e(d).order.OrderItems,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:_(()=>[o(e(h),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:_(n=>[r("p",null,w(n.data.Quantity)+" "+w(n.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),o(e(h),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),o(e(h),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),o(e(h),{headerClass:"!bg-primary-900",field:"Problems",header:"Problema"},{body:_(n=>[(l(!0),C(E,null,V(n.data.Problems,(O,D)=>(l(),C("p",{class:"mt-2 mr-3 tag-radius tag-rounded-blue tag-font-method",key:D},w(t(O.ProblemName)),1))),128))]),_:1})]),_:1},8,["value"])),r("div",null,[(m=e(d).order)!=null&&m.HasProblems?(l(),b(e(A),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:(y=e(d).order)==null?void 0:y.Problems},{default:_(()=>[o(e(h),{headerClass:"!bg-primary-900",field:"ProblemName",header:"Probelma"},{body:_(n=>[r("p",null,w(n.data.ProblemName),1)]),_:1}),o(e(h),{headerClass:"!bg-primary-900",field:"Other",header:"Descripcion"},{body:_(n=>[r("p",{innerHTML:n.data.Other},null,8,ye)]),_:1})]),_:1},8,["value"])):f("",!0)]),r("div",Pe,[Oe,S(),De,S(),r("span",{innerHTML:p(e(d).order.Comments)},null,8,Ce)])]),o(e(I),{label:"Cerrar",onClick:a[0]||(a[0]=n=>e(d).showDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]}),_:1}))}},Ne=r("h1",{class:"mb-3 mt-3 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-info-circle !text-xl rotate-180"}),S(" Reportar problema ")],-1),Me=r("p",{class:"mb-3"},"Por favor indique uno o más problemas detectados",-1),ke={key:0,class:"mt-4"},$e=r("p",{class:"mb-3"},"Por favor indique el problema detectado",-1),we={__name:"DialogReportProblem",props:{order:Object,product:Object,typeProblems:String,problemsProduct:Object},setup(x,{emit:d}){const t=x,p=X(),i=H(),a=c([]),m=c([]),y=c(!1),n=c(null),O=c(null),D=c(!0),g=c(!1),M=c(!1),u=c(!1),s=c([]);K(async()=>{await p.getProblems(t.typeProblems),a.value=p.problems});const k=()=>{D.value=!0,g.value=!1,m.value=[],n.value=""};T(()=>t.order,P=>{s.value=P,t.typeProblems==v.RESPONSIBLE_CDA&&(m.value=[])});const $=()=>{D.value=!0,t.typeProblems==v.RESPONSIBLE_CDA&&(i.currentOrder.action="reject",i.currentOrder.orderId=t.order.id,i.currentOrder.problems=m.value,i.currentOrder.other=n.value,d("processOrder"))};T(()=>t.problemsProduct,P=>{P!=null&&(m.value=[...P],u.value=P.length>0,P.map(N=>{N.title==="Otro"&&(n.value=N.other,g.value=!!B(n.value).trim())}))}),T(m,P=>{y.value=P.some(N=>N.title==="Otro"),D.value=P.length===0||y.value&&!g.value,t.typeProblems===v.RESPONSIBLE_PICKER_REVIEWER&&(O.value=t.product,M.value||(O.value.problems=P))}),T(n,()=>{y.value?(g.value=!!B(n.value).trim(),D.value=!g.value):D.value=!1});const B=P=>new DOMParser().parseFromString(P,"text/html").body.innerText;return(P,N)=>(l(),b(e(U),{modal:"",header:" ",style:{width:"70vw"},"onUpdate:visible":k},{default:_(()=>[r("div",null,[Ne,Me,o(e(A),{selection:m.value,"onUpdate:selection":N[0]||(N[0]=L=>m.value=L),value:a.value,dataKey:"id"},{default:_(()=>[o(e(h),{headerClass:"!bg-primary-900",header:"Seleccionar",selectionMode:"multiple"}),o(e(h),{headerClass:"!bg-primary-900",field:"title",header:"Problema detectado"})]),_:1},8,["selection","value"]),y.value?(l(),C("div",ke,[$e,o(e(Z),{class:"custom-editor",modelValue:n.value,"onUpdate:modelValue":N[1]||(N[1]=L=>n.value=L),editorStyle:"height: 80px"},null,8,["modelValue"])])):f("",!0)]),r("div",null,[o(e(I),{label:"Reportar",disabled:D.value,onClick:$,class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"},null,8,["disabled"])])]),_:1}))}},Se={key:0,class:"pb-10"},Te={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},Ie={class:"flex"},z={__name:"DataTableOrdersCda",props:{title:String,type:String,orders:Array,toManage:Boolean,totalOrders:Number},setup(x,{emit:d}){const t=x,p=H(),i=c(t.orders),a=c({here:[{label:"Ver observación",value:"observation"}],"pickup-delivery":[{label:"Ver documentos",value:"detail"}]}),m=c({here:[{label:"Informado",value:v.ACTION_INFO}],"pickup-delivery":[{label:"Rechazar",value:"reportProblem"},{label:"Autorizar",value:v.ACTION_APPROVE}]}),y=c(["DocNum","Customer","DocTotal","DocTime","DocDate"]);T(()=>t.orders,()=>{i.value=t.orders});const n=g=>{console.log(g)},O=(g,M)=>{if([v.ACTION_INFO,v.ACTION_APPROVE].includes(g)){p.currentOrder.orderId=M.id,p.currentOrder.action=g,d("processOrder");return}p.order=M,p.showDialog=!0,p.typeDialog=g},D=g=>{i.value=g.orders};return(g,M)=>i.value.length>0?(l(),C("div",Se,[r("div",null,[r("h2",Te,w(t.title),1)]),r("div",Ie,[o(ee,{allOrders:t.orders,typeOrders:t.type,filters:y.value,onFilter:D},null,8,["allOrders","typeOrders","filters"])]),o(e(A),{value:i.value,rowsPerPageOptions:[5,10,20,50],rows:5,onPage:n,paginator:"",dataKey:"id",filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:_(()=>[o(e(h),{headerClass:"!bg-primary-900",field:"DocNum",header:"Nota de venta",sortable:""},{body:_(u=>[S(" N° "+w(u.data.DocNum),1)]),_:1}),o(e(h),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),o(e(h),{headerClass:"!bg-primary-900",sortable:"",field:"DocTime",header:"Hora"}),o(e(h),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente"}),o(e(h),{headerClass:"!bg-primary-900",sortable:"",field:"DocTotal",header:"Monto total"}),o(e(h),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:_(u=>[t.type==e(v).METHOD_SHIPPING_HERE?(l(),b(e(R),{key:0,Tag:"",icon:"pi pi-shopping-cart",value:u.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])):f("",!0),t.type==e(v).METHOD_SHIPPING_PICKUP_AND_DELIVERY?(l(),b(e(R),{key:1,Tag:"",icon:u.data.method_shipping_id===e(v).METHOD_SHIPPING_PICKUP_ID?"pi pi-home":"pi pi-truck",value:u.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["icon","value"])):f("",!0)]),_:1}),o(e(h),{headerClass:"!bg-primary-900",field:"note",header:"Documentos"},{body:_(u=>[(l(!0),C(E,null,V(a.value[t.type],s=>(l(),b(e(I),{icon:"pi pi-eye",onClick:k=>O(s.value,u.data),class:"!font-normal !text-primary-900",label:s.label,link:""},null,8,["onClick","label"]))),256))]),_:1}),t.toManage?f("",!0):(l(),b(e(h),{key:0,headerClass:"!bg-primary-900",field:"note",header:"Observación"},{body:_(u=>[u.data.HasProblems?(l(),b(e(I),{key:0,icon:"pi pi-eye",onClick:s=>O("observation",u.data),class:"!font-normal !text-primary-900",label:"Ver observación",link:""},null,8,["onClick"])):f("",!0)]),_:1})),t.toManage?(l(),b(e(h),{key:1,headerClass:"!bg-primary-900",field:"note",header:""},{body:_(u=>[(l(!0),C(E,null,V(m.value[t.type],s=>(l(),b(e(I),{label:s.label,onClick:k=>O(s.value,u.data),class:"!py-1.5 mr-3 !border-primary-900 !text-primary-900",outlined:""},null,8,["label","onClick"]))),256))]),_:1})):f("",!0)]),_:1},8,["value"])])):f("",!0)}};const Ee={class:"flex justify-between"},Re=r("i",{class:"pi pi-refresh"},null,-1),He=[Re],Le={key:4,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},Ve=r("h1",{class:"align-center font-inter font-semibold mb-4 text-2xl text-center text-primary-900"}," No se han encontrado ordenes ",-1),Ae=[Ve],G={__name:"ToManage",props:{toManage:Boolean,orders:Array},setup(x,{emit:d}){const t=x,{showToast:p}=j.setup(),{showConfirm:i}=te.setup(),a=H(),m=c([]),y=c([]),n=c(v.RESPONSIBLE_CDA+":"+t.toManage),O=async()=>{d("updateOrders")};Y(async()=>{g(t.orders)});const D=u=>{g(u.orders)};T(()=>t.orders,()=>{g(t.orders)});const g=u=>{m.value=u.filter(s=>s.method_shipping_id===v.METHOD_SHIPPING_HERE_ID).sort((s,k)=>new Date(k.updated_at)-new Date(s.updated_at)),y.value=u.filter(s=>s.method_shipping_id!==v.METHOD_SHIPPING_HERE_ID).sort((s,k)=>new Date(k.updated_at)-new Date(s.updated_at))},M=async()=>{if(await i())try{let s=await a.processOrderCda();s.status==="success"&&(a.showDialog=!1,p({status:s.status,message:s.message}),a.getOrdersCdaManage())}catch(s){s.response&&p({status:s.response.data.status,message:s.response.data.message})}else p({status:"info",message:"Proceso cancelado"})};return(u,s)=>{const k=W("DialogaddObservation");return l(),C(E,null,[r("div",Ee,[r("div",null,[r("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"},[S(" Notas de venta "),r("a",{style:{cursor:"pointer"},onClick:O},He)])]),o(Q,{type:n.value,orders:t.orders,onSearch:D},null,8,["type","orders"])]),o(z,{title:"Aquí",type:e(v).METHOD_SHIPPING_HERE,totalOrders:t.totalOrders,orders:m.value,toManage:x.toManage,onProcessOrder:M},null,8,["type","totalOrders","orders","toManage"]),o(z,{title:"Retiro / Despacho",type:e(v).METHOD_SHIPPING_PICKUP_AND_DELIVERY,totalOrders:t.totalOrders,orders:y.value,toManage:x.toManage,onProcessOrder:M},null,8,["type","totalOrders","orders","toManage"]),e(a).typeDialog==="detail"?(l(),b(ge,{key:0,visible:e(a).showDialog,"onUpdate:visible":s[0]||(s[0]=$=>e(a).showDialog=$),order:e(a).order},null,8,["visible","order"])):f("",!0),e(a).typeDialog==="observation"?(l(),b(xe,{key:1,visible:e(a).showDialog,"onUpdate:visible":s[1]||(s[1]=$=>e(a).showDialog=$),order:e(a).order},null,8,["visible","order"])):f("",!0),e(a).typeDialog==="reportProblem"?(l(),b(we,{key:2,visible:e(a).showDialog,"onUpdate:visible":s[2]||(s[2]=$=>e(a).showDialog=$),typeProblems:e(v).RESPONSIBLE_CDA,order:e(a).order,onProcessOrder:M},null,8,["visible","typeProblems","order"])):f("",!0),e(a).typeDialog==="addObservation"?(l(),b(k,{key:3,visible:e(a).showDialog,"onUpdate:visible":s[3]||(s[3]=$=>e(a).showDialog=$),typeProblems:e(v).RESPONSIBLE_CDA,order:e(a).order,disabled:!0},null,8,["visible","typeProblems","order"])):f("",!0),m.value.length===0&&y.value.length===0?(l(),C("div",Le,Ae)):f("",!0)],64)}}};const Ue={class:"px-3"},Be={key:0,class:"text-center",style:{color:"#259bd7"}},Fe=r("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),ze=[Fe],at={__name:"SalesNotes",setup(x){const{showToast:d}=j.setup(),t=H(),p=c([]),i=c([]),a=c(!1);K(()=>{t.getOrdersCdaToManager().then(()=>{p.value=t.listOrders}),t.getOrdersCdaManage().then(()=>{i.value=t.listOrdersManage}),a.value=!0});const m=()=>{t.getOrdersCdaToManager().then(()=>{p.value=t.listOrders}),t.getOrdersCdaManage().then(()=>{i.value=t.listOrdersManage}),d({status:"success",title:"Ordenes actualizadas",message:"Las ordenes se han actualizado correctamente"})};return T(()=>[t.listOrders,t.listOrdersManage],()=>{p.value=t.listOrders,i.value=t.listOrdersManage}),(y,n)=>(l(),C(E,null,[r("div",Ue,[o(e(q),{modelValue:y.selectedTab,"onUpdate:modelValue":n[0]||(n[0]=O=>y.selectedTab=O)},{default:_(()=>[o(e(F),{header:"Por gestionar"},{default:_(()=>[a.value?f("",!0):(l(),C("div",Be,ze)),a.value?(l(),b(G,{key:1,toManage:!0,orders:p.value,onUpdateOrders:m},null,8,["orders"])):f("",!0)]),_:1}),o(e(F),{header:"Gestionadas"},{default:_(()=>[a.value?(l(),b(G,{key:0,toManage:!1,orders:i.value,onUpdateOrders:m},null,8,["orders"])):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),o(e(J))],64))}};export{at as default};
