import{y as F,e as O,o as m,k as y,w as o,h as g,t as b,a as i,u as r,p as v,c as H,l as A,F as G,s as k,m as z,i as P,v as K}from"./index-1730fa93.js";import{s as n,b as I,a as N}from"./tag.esm-1e519b5f.js";import{_ as j}from"./FilterMultiSelect-7d98fb57.js";import{c as x,T as Q,C as q}from"./ConfirmMixin-09fdbf34.js";import{u as W}from"./OrdersApiService-bd4fdae8.js";const S=W(),T=F("ordersBills",{state:()=>({listOrders:[],order:[],visibleDialog:!1,orderProcessingStatus:{},bill:{},visibleBill:!1}),getters:{orders:a=>a.listOrders},actions:{async getOrdersBillPickupAndHere(){let a=await S.getOrdersBillPickupAndHere();this.listOrders=a.data},async getOrdersBillDelivery(){let a=await S.getOrdersBillDelivery();this.listOrders=a.data},async getOrdersBillManage(a){return(await S.getOrdersBillManage(a)).data},async processOrderBiller(a){let l=await S.processOrderBiller(a);return l.data.order_status_id===x.ORDER_STATUS_BILLED?this.listOrders=this.listOrders.filter(t=>t.id!==l.data.id):this.listOrders=this.listOrders.map(t=>t.id===l.data.id?l.data:t),l},async returnProcessOrderBiller(a){return await S.returnProcessOrderBiller(a)},showDetailOrder(a){this.order=a,this.visibleDialog=!0},showDetailBiller(a){this.bill=a.bill,this.visibleBill=!0}}}),Y=g("h1",{class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},[g("i",{class:"pi pi-eye !text-xl"}),P(" Ver detalles ")],-1),J=g("div",{class:"mt-2 mb-1 text-primary-900 font-semi-bold"},[g("p",null,"Productos")],-1),ie={__name:"DialogDetail",setup(a){var _;const l=T(),t=O(l.order),c=O((_=l.order)==null?void 0:_.OrderItems),h=D=>{switch(D.pivot.task){case"reviewer":return"Revisado por:";case"picker":return"Preparado por";case"cda":return"Autorizado por"}};return(D,w)=>(m(),y(r(z),{modal:"",header:" ",maximizable:"",style:{width:"70vw"}},{default:o(()=>[g("div",null,[Y,g("p",null,"Revisa aquí los detalles de la nota de venta N° "+b(t.value.DocNum),1)]),J,i(r(I),{tableStyle:"min-width: 50rem",filters:"filters",value:c.value},{default:o(()=>[i(r(n),{headerClass:"!bg-primary-900",field:"date",header:"Cantidad"},{body:o(s=>[g("p",null,b(s.data.Quantity)+" "+b(s.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),i(r(n),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),i(r(n),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),i(r(n),{headerClass:"!bg-primary-900",field:"WarehouseCode",header:"Bodega"}),i(r(n),{headerClass:"!bg-primary-900",field:"U_SBO_StockVentas",header:"Stock Ventas"},{body:o(s=>[g("p",null,b(s.data.U_SBO_StockVentas)+" "+b(s.data.U_SBO_StockVentas>1?"Unidades":"Unidad"),1)]),_:1})]),_:1},8,["value"]),i(r(I),{class:"pt-5",tableStyle:"min-width: 50rem",value:[t.value]},{default:o(()=>[i(r(n),{headerClass:"!bg-primary-900",field:"SalesEmployeeName",header:"Vendedor"},{body:o(s=>{var f,d;return[(f=s.data)!=null&&f.SalesEmployeeName?(m(),y(r(N),{key:0,icon:"pi pi-user",value:(d=s.data)==null?void 0:d.SalesEmployeeName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):v("",!0)]}),_:1}),(m(!0),H(G,null,A(t.value.Responsibles,s=>(m(),y(r(n),{headerClass:"!bg-primary-900",field:"responsible",header:h(s)},{body:o(f=>[s.name?(m(),y(r(N),{key:0,icon:"pi pi-user",value:s.name,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):v("",!0)]),_:2},1032,["header"]))),256))]),_:1},8,["value"]),i(r(k),{label:"Cerrar",onClick:w[0]||(w[0]=s=>r(l).visibleDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]),_:1}))}};const X={key:0},Z={class:"flex"},le={__name:"DataTableOrders",props:{type:String,actions:Object,orders:Object},setup(a,{emit:l}){const t=a,c=T(),h=O(t.orders),_=O(t.orders),D=O(["DocNum","Customer","DocTotal","DocTime","DocDate"]),w=d=>{switch(d.method_shipping_id){case x.METHOD_SHIPPING_DELIVERY_ID:return"pi pi-truck";case x.METHOD_SHIPPING_PICKUP_ID:return"pi pi-home";case x.METHOD_SHIPPING_HERE_ID:return"pi pi-shopping-cart";default:return"pi pi-shopping-cart"}},s=(d,E,e=null)=>{l("action",{method:d,document:e,responsible:"biller",order:E})},f=d=>{h.value=d.orders};return K(()=>t.orders,d=>{h.value=d,_.value=d}),(d,E)=>h.value.length>0?(m(),H("div",X,[g("div",Z,[i(j,{typeOrders:"here",allOrders:_.value,filters:D.value,onFilter:f},null,8,["allOrders","filters"])]),i(r(I),{tableStyle:"min-width: 50rem",filters:"filters",value:h.value,paginator:"",rowsPerPageOptions:[5,10,20,50],rows:5,dataKey:"id",filterDisplay:"row",loading:d.loading,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:o(()=>[i(r(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:o(e=>[P(" N° "+b(e.data.DocNum),1)]),_:1}),i(r(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),i(r(n),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente",style:{"max-width":"300px"}}),i(r(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocTotal",header:"Monto total"}),i(r(n),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:o(e=>[i(r(N),{icon:w(e.data),value:e.data.MethodShippingName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["icon","value"])]),_:1}),i(r(n),{headerClass:"!bg-primary-900",field:"note",header:"Detalles"},{body:o(e=>[i(r(k),{icon:"pi pi-eye",onClick:u=>s("showDetailOrder",e.data),class:"!text-primary-900",label:"Ver detalles",link:""},null,8,["onClick"])]),_:1}),i(r(n),{headerClass:"!bg-primary-900",field:"client",header:"Emitir"},{body:o(e=>{var u,p,B,M;return[e.data.is_managed_in_billing?(m(),y(r(k),{key:0,label:"Gestionar",onClick:C=>s("returnProcessOrderBiller",e.data,e.data.U_SBO_FormaPago),class:"!py-1.5 !border-primary-900 !text-primary-900 mr-3",severity:"primary",style:{width:"100px"},outlined:""},null,8,["onClick"])):v("",!0),!((u=r(c).orderProcessingStatus[e.data.id])!=null&&u.inProcess)&&e.data.is_managed_in_billing==!1?(m(),y(r(k),{key:1,label:e.data.U_SBO_FormaPago,onClick:C=>s("processOrderBiller",e.data,e.data.U_SBO_FormaPago),class:"!py-1.5 !border-primary-900 !text-primary-900 mr-3",severity:"primary",style:{width:"100px"},outlined:""},null,8,["label","onClick"])):(p=r(c).orderProcessingStatus[e.data.id])!=null&&p.inProcess?(m(),y(r(N),{key:2,severity:(B=r(c).orderProcessingStatus[e.data.id])==null?void 0:B.severity,icon:(M=r(c).orderProcessingStatus[e.data.id])==null?void 0:M.icon,class:"tag-font-method tag-radius"},{default:o(()=>{var C,U,$,V;return[g("span",null,b((C=r(c).orderProcessingStatus[e.data.id])==null?void 0:C.status),1),((U=r(c).orderProcessingStatus[e.data.id])==null?void 0:U.severity)==="success"?(m(),y(r(k),{key:0,onClick:L=>{var R;return s("showDetailBill",(R=r(c).orderProcessingStatus[e.data.id])==null?void 0:R.order)},class:"show-bill-details",link:""},{default:o(()=>[P(" Ver ")]),_:2},1032,["onClick"])):v("",!0),((V=($=r(c).orderProcessingStatus[e.data.id])==null?void 0:$.order)==null?void 0:V.bill)===null?(m(),y(r(k),{key:1,onClick:L=>s("processOrderBiller",e.data,e.data.U_SBO_FormaPago),class:"show-bill-details",style:{"min-width":"105px !important"},link:""},{default:o(()=>[P(" Reintentar ")]),_:2},1032,["onClick"])):v("",!0)]}),_:2},1032,["severity","icon"])):v("",!0)]}),_:1})]),_:1},8,["value","loading"])])):v("",!0)}};function de(){const a=T(),l=O([]),{showToast:t}=Q.setup(),{showConfirm:c}=q.setup(),h=O(!1),_=e=>{l.value=e.orders},D=e=>{switch(e.method){case"showDetailOrder":a.showDetailOrder(e.order);break;case"showDetailBill":a.showDetailBiller(e.order);break;case"processOrderBiller":d(e);break;case"returnProcessOrderBiller":f(e)}},w=async e=>{e==="delivery"?await a.getOrdersBillDelivery():await a.getOrdersBillPickupAndHere(),t({status:"success",message:"Ordenes actualizadas",time:3e3})},s=()=>{l.value.length===0&&(window.location.href="/admin/dashboard/")},f=async e=>{try{await c()?await a.returnProcessOrderBiller(e).then(p=>{p.status==="success"&&(l.value=l.value.filter(B=>B.id!=p.data.id),t({status:"success",message:p.message}))}):t({status:"info",message:"Proceso cancelado"})}catch(u){t({status:"error",message:u.response.data.message})}},d=async e=>{try{await c()?(a.orderProcessingStatus[e.order.id]={inProcess:!0,status:"Procesando...",severity:"info",icon:"pi pi-spin pi-spinner"},await a.processOrderBiller(e).then(p=>{p.status==="success"&&(a.orderProcessingStatus[e.order.id]={inProcess:!0,status:"Documento Emitido",severity:"success",icon:"pi pi-check",order:p.data},t({status:"success",message:p.message}))})):t({status:"info",message:"Proceso cancelado"})}catch(u){a.orderProcessingStatus[e.order.id]={inProcess:!0,status:"Error al emitir el documento",severity:"danger",icon:"pi pi-times",order:u.response.data.data},u.response.status==401&&l.value.filter(p=>p.id!==u.response.data.data.id),t({status:"error",message:u.response.data.message})}};return{orders:l,updateOrders:w,visible:h,visibleDetailsMethod:e=>{h.value=e.visibleDetails},actionMethod:D,goBack:s,search:_,orderStore:a}}export{le as _,ie as a,T as b,de as u};
