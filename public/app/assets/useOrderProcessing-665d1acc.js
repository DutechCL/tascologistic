import{y as V,e as _,o as g,k as D,w as c,h as m,t as O,a as s,u as e,p as w,c as M,l as R,F as $,s as k,m as H,i as U,v as L}from"./index-c9913481.js";import{s as n,b as B,a as C}from"./tag.esm-986a8a05.js";import{_ as F}from"./FilterMultiSelect-77b9d12a.js";import{c as S,T as A,C as z}from"./ConfirmMixin-881a5905.js";import{u as G}from"./OrdersApiService-919c32bf.js";const P=G(),x=V("ordersBills",{state:()=>({listOrders:[],order:[],visibleDialog:!1,orderProcessingStatus:{}}),getters:{orders:a=>a.listOrders},actions:{async getOrdersBillPickupAndHere(){let a=await P.getOrdersBillPickupAndHere();this.listOrders=a.data},async getOrdersBillDelivery(){let a=await P.getOrdersBillDelivery();this.listOrders=a.data},async processOrderBiller(a){let d=await P.processOrderBiller(a);return d.data.order_status_id===S.ORDER_STATUS_BILLED?this.listOrders=this.listOrders.filter(i=>i.id!==d.data.id):this.listOrders=this.listOrders.map(i=>i.id===d.data.id?d.data:i),d},showDetailOrder(a){this.order=a,this.visibleDialog=!0}}}),K=m("h1",{class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},[m("i",{class:"pi pi-eye !text-xl"}),U(" Ver detalles ")],-1),j=m("div",{class:"mt-2 mb-1 text-primary-900 font-semi-bold"},[m("p",null,"Productos")],-1),re={__name:"DialogDetail",setup(a){var y;const d=x(),i=_(d.order),u=_((y=d.order)==null?void 0:y.OrderItems),p=v=>{switch(v.pivot.task){case"reviewer":return"Revisado por:";case"picker":return"Preparado por";case"cda":return"Autorizado por"}};return(v,b)=>(g(),D(e(H),{modal:"",header:" ",maximizable:"",style:{width:"70vw"}},{default:c(()=>[m("div",null,[K,m("p",null,"Revisa aquí los detalles de la nota de venta N° "+O(i.value.DocNum),1)]),j,s(e(B),{tableStyle:"min-width: 50rem",filters:"filters",value:u.value},{default:c(()=>[s(e(n),{headerClass:"!bg-primary-900",field:"date",header:"Cantidad"},{body:c(t=>[m("p",null,O(t.data.Quantity)+" "+O(t.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),s(e(n),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),s(e(n),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),s(e(n),{headerClass:"!bg-primary-900",field:"WarehouseCode",header:"Bodega"}),s(e(n),{headerClass:"!bg-primary-900",field:"U_SBO_StockVentas",header:"Stock Ventas"},{body:c(t=>[m("p",null,O(t.data.U_SBO_StockVentas)+" "+O(t.data.U_SBO_StockVentas>1?"Unidades":"Unidad"),1)]),_:1})]),_:1},8,["value"]),s(e(B),{class:"pt-5",tableStyle:"min-width: 50rem",value:[i.value]},{default:c(()=>[s(e(n),{headerClass:"!bg-primary-900",field:"SalesEmployeeName",header:"Vendedor"},{body:c(t=>{var f,l;return[(f=t.data)!=null&&f.SalesEmployeeName?(g(),D(e(C),{key:0,icon:"pi pi-user",value:(l=t.data)==null?void 0:l.SalesEmployeeName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):w("",!0)]}),_:1}),(g(!0),M($,null,R(i.value.Responsibles,t=>(g(),D(e(n),{headerClass:"!bg-primary-900",field:"responsible",header:p(t)},{body:c(f=>[t.name?(g(),D(e(C),{key:0,icon:"pi pi-user",value:t.name,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):w("",!0)]),_:2},1032,["header"]))),256))]),_:1},8,["value"]),s(e(k),{label:"Cerrar",onClick:b[0]||(b[0]=t=>e(d).visibleDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]),_:1}))}};const Q={key:0},q={class:"flex"},ae={__name:"DataTableOrders",props:{type:String,actions:Object,orders:Object},setup(a,{emit:d}){const i=a,u=x(),p=_(i.orders),y=_(i.orders),v=_(["DocNum","Customer","DocTotal","DocTime","DocDate"]),b=l=>{switch(l.method_shipping_id){case S.METHOD_SHIPPING_DELIVERY_ID:return"pi pi-truck";case S.METHOD_SHIPPING_PICKUP_ID:return"pi pi-home";case S.METHOD_SHIPPING_HERE_ID:return"pi pi-shopping-cart";default:return"pi pi-shopping-cart"}},t=(l,o,r=null)=>{d("action",{method:l,document:r,responsible:"biller",order:o})},f=l=>{p.value=l.orders};return L(()=>i.orders,l=>{p.value=l,y.value=l}),(l,o)=>p.value.length>0?(g(),M("div",Q,[m("div",q,[s(F,{typeOrders:"here",allOrders:y.value,filters:v.value,onFilter:f},null,8,["allOrders","filters"])]),s(e(B),{tableStyle:"min-width: 50rem",filters:"filters",value:p.value,paginator:"",rowsPerPageOptions:[5,10,20,50],rows:5,dataKey:"id",filterDisplay:"row",loading:l.loading,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:c(()=>[s(e(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:c(r=>[U(" N° "+O(r.data.DocNum),1)]),_:1}),s(e(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),s(e(n),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente",style:{"max-width":"300px"}}),s(e(n),{headerClass:"!bg-primary-900",sortable:"",field:"DocTotal",header:"Monto total"}),s(e(n),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:c(r=>[s(e(C),{icon:b(r.data),value:r.data.MethodShippingName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["icon","value"])]),_:1}),s(e(n),{headerClass:"!bg-primary-900",field:"note",header:"Detalles"},{body:c(r=>[s(e(k),{icon:"pi pi-eye",onClick:h=>t("showDetailOrder",r.data),class:"!text-primary-900",label:"Ver detalles",link:""},null,8,["onClick"])]),_:1}),s(e(n),{headerClass:"!bg-primary-900",field:"client",header:"Emitir"},{body:c(r=>{var h,N,E,I,T;return[(h=e(u).orderProcessingStatus[r.data.id])!=null&&h.inProcess?(N=e(u).orderProcessingStatus[r.data.id])!=null&&N.inProcess?(g(),D(e(C),{key:1,value:(E=e(u).orderProcessingStatus[r.data.id])==null?void 0:E.status,severity:(I=e(u).orderProcessingStatus[r.data.id])==null?void 0:I.severity,icon:(T=e(u).orderProcessingStatus[r.data.id])==null?void 0:T.icon,class:"tag-font-method tag-radius"},null,8,["value","severity","icon"])):w("",!0):(g(),D(e(k),{key:0,label:r.data.U_SBO_FormaPago,onClick:W=>t("processOrderBiller",r.data,r.data.U_SBO_FormaPago),class:"!py-1.5 !border-primary-900 !text-primary-900 mr-3",severity:"primary",style:{width:"100px"},outlined:""},null,8,["label","onClick"]))]}),_:1})]),_:1},8,["value","loading"])])):w("",!0)}};function se(){const a=x(),d=_([]),{showToast:i}=A.setup(),{showConfirm:u}=z.setup(),p=_(!1),y=o=>{d.value=o.orders},v=o=>{switch(o.method){case"showDetailOrder":a.showDetailOrder(o.order);break;case"processOrderBiller":f(o);break}},b=async o=>{o==="delivery"?await a.getOrdersBillDelivery():await a.getOrdersBillPickupAndHere(),i({status:"success",message:"Ordenes actualizadas",time:3e3})},t=()=>{d.value.length===0&&(window.location.href="/admin/dashboard/")},f=async o=>{try{if(await u()){a.orderProcessingStatus[o.order.id]={inProcess:!0,status:"Procesando...",severity:"info",icon:"pi pi-spin pi-spinner"};let h=await a.processOrderBiller(o);h.status==="success"&&(a.orderProcessingStatus[o.order.id]={inProcess:!0,status:"Documento Emitido",severity:"success",icon:"pi pi-check"},i({status:"success",message:h.message}))}else i({status:"info",message:"Proceso cancelado"})}catch(r){a.orderProcessingStatus[o.order.id]={inProcess:!0,status:"Error al emitir el documento",severity:"danger",icon:"pi pi-times"},r.response.status==401&&d.value.filter(h=>h.id!==r.response.data.data.id),i({status:"error",message:r.response.data.message})}};return{orders:d,updateOrders:b,visible:p,visibleDetailsMethod:o=>{p.value=o.visibleDetails},actionMethod:v,goBack:t,search:y,orderStore:a}}export{ae as _,re as a,se as u};
