import{s as d,a as N,b as j}from"./tag.esm-77e63657.js";import{a as me,_ as ve}from"./DialogReportProblem-29c15869.js";import{u as be}from"./OrdersApiService-575f0a71.js";import{e as n,l as re,o as p,c as O,h as i,t as T,a as r,w as y,u as e,i as Q,m as _,v,n as he,s as I,x as ge,k as ye,r as fe,F as te,j as ae,p as _e,z as Ce}from"./index-781ac360.js";import{_ as Re,c as g,T as ke,C as Se}from"./FilterMultiSelect-39698c15.js";import"./index.esm-1bb07566.js";import"./ApiService-47635b29.js";import"./index.esm-dba15ae6.js";import"./index.esm-0103551d.js";const Ee={key:0},xe={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},Pe={class:"flex"},se={__name:"DataTableOrdersPickerReview",props:{title:String,type:String,orders:Array},setup(H,{emit:M}){const b=H,w=n(b.orders);re(()=>b.orders,o=>{w.value=o});const h=o=>{w.value=o.orders},f=(o,u)=>{let s=C(o,u)!==void 0;M("action",{order:o,type:u,responsible:s})},C=(o,u)=>{var s;return(s=o.Responsibles.find(c=>c.pivot.task==u))==null?void 0:s.name};function R(o){const u=E(o);return(.299*u.r+.587*u.g+.114*u.b)/255>.5?"#000000":"#FFFFFF"}function E(o){const u=parseInt(o.substring(1),16),s=u>>16&255,c=u>>8&255,A=u&255;return{r:s,g:c,b:A}}return(o,u)=>b.orders.length>0?(p(),O("div",Ee,[i("h2",xe,T(b.title),1),i("div",Pe,[r(Re,{typeOrders:b.type,allOrders:b.orders,onFilter:h},null,8,["typeOrders","allOrders"])]),r(e(j),{class:"mb-20",value:w.value,tableStyle:"min-width: 50rem",filters:"filters",paginator:"",rows:5,dataKey:"id",filterDisplay:"row",loading:o.loading,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:y(()=>[r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:y(s=>[Q(" N° "+T(s.data.DocNum),1)]),_:1}),r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"DocTime",header:"Hora"}),r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente"}),r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:y(s=>[r(e(N),{Tag:"",icon:"pi pi-shopping-cart",value:s.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),_:1}),r(e(d),{headerClass:"!bg-primary-900",field:"ResponsiblePickerName",header:"Picker"},{body:y(s=>[C(s.data,e(g).RESPONSIBLE_PICKER)?(p(),_(e(N),{key:0,icon:"pi pi-user",value:C(s.data,e(g).RESPONSIBLE_PICKER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):v("",!0)]),_:1}),r(e(d),{headerClass:"!bg-primary-900",field:"ResponsibleReviewerName",header:"Revisor"},{body:y(s=>[C(s.data,e(g).RESPONSIBLE_REVIEWER)?(p(),_(e(N),{key:0,icon:"pi pi-user",value:C(s.data,e(g).RESPONSIBLE_REVIEWER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):v("",!0)]),_:1}),r(e(d),{headerClass:"!bg-primary-900",sortable:"",field:"OrderStatusName",header:"Estado"},{body:y(s=>[r(e(N),{icon:"pi pi-circle-fill",value:s.data.OrderStatusName,style:he({backgroundColor:s.data.OrderStatusColor,color:R(s.data.OrderStatusColor)}),class:"tag-font-method tag-radius"},null,8,["value","style"])]),_:1}),r(e(d),{headerClass:"!bg-primary-900",field:"note",header:""},{body:y(s=>[[e(g).ORDER_STATUS_PICKED,e(g).ORDER_STATUS_ON_HOLD].includes(s.data.order_status_id)?(p(),_(e(I),{key:0,label:"Piekear",onClick:c=>f(s.data,e(g).RESPONSIBLE_PICKER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):v("",!0),s.data.order_status_id==e(g).ORDER_STATUS_REVIEWER?(p(),_(e(I),{key:1,label:"Revisar",onClick:c=>f(s.data,e(g).RESPONSIBLE_REVIEWER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):v("",!0)]),_:1})]),_:1},8,["value","loading"])])):v("",!0)}};const Oe={class:"px-8"},Ne={key:0,class:"text-center",style:{color:"#259bd7"}},Ie=i("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),we=[Ie],De={key:1},Te={class:"flex justify-between"},Ae=i("i",{class:"pi pi-refresh"},null,-1),Le=[Ae],$e={key:2},Be={class:"px-8"},Fe={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},He=i("i",{class:"pi pi-inbox !text-xl"},null,-1),Me=i("div",{class:"flex align-center mb-2"},null,-1),Ve={class:"mini-table mt-8"},Ue={class:"mt-8 flex float-right"},Ke=i("div",{class:"space"},null,-1),ze={class:"content-picker-problem"},We={key:0,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},je=i("h1",{class:"align-center font-inter font-semibold mb-4 text-2xl text-center text-primary-900"}," No se han encontrado ordenes ",-1),Qe=[je],st={__name:"PickupReview",props:{wareHouseCode:String},setup(H){const M=H,{showToast:b}=ke.setup(),{showConfirm:w}=Se.setup(),h=be(),f=n([]),C=n([]),R=n([]),E=n([]),o=n([]),u=n(!1),s=n(!0),c=n([]),A=n([]),L=n([]),V=n([]),U=new Set,$=new Set,B=new Set,D=n(!1),F=n(!1),q=n(""),x=n([]),P=n([]),k=n([]),{listOrdersHere:K,listOrdersPickup:z,listOrdersDelivery:G}=ge(h.$state),le=()=>{Z()};re(()=>h.orders,t=>{x.value=K.value,P.value=z.value,k.value=G.value}),ye(()=>{try{h.wareHouseCode=M.wareHouseCode,Z(),x.value=K.value,P.value=z.value,k.value=G.value,D.value=!0}catch(t){console.error("Error fetching orders:",t)}});const oe=t=>{x.value=W(K.value,t),P.value=W(z.value,t),k.value=W(k.value,t)};function W(t,l){return t.filter(m=>m.DocNum.toString().includes(l.value.toString())||m.Customer.CardName.toLowerCase().includes(l.value.toLowerCase()))}const Y=t=>{F.value=!0,f.value=t.order,R.value=t.order.OrderItems,q.value=t.type,t.responsible||ue(t.type)},J=()=>{F.value=!1,ie()},ie=()=>{B.clear(),U.clear(),$.clear(),s.value=!0,c.value=[],V.value=[],R.value.forEach(t=>{o.value[t.id]=!1,E.value[t.id]=!1})},X=(t,l)=>{const m=l==="complete"?B.add(t):B.delete(t);if(t.id){const a=l==="complete"?U.add(t):U.delete(t);l==="complete"?(o.value[t.id]=!1,$.delete(t),c.value=Array.from($)):V.value=t.problems,E.value[t.id]=l==="complete",h.visibleReport=l!=="complete",C.value=l!=="complete"?t:null,L.value=Array.from(m),s.value=L.value.length!==R.value.length,A.value=Array.from(a)}},ne=({value:t,tempSelection:l})=>{t||(h.visibleReport=u.visibleReport,c.value=l)},de=(t,l)=>{t.problems=l.listProblems;let m=B.add(t);L.value=Array.from(m);let a=$.add(t);c.value=Array.from(a),s.value=L.value.length!==R.value.length,c.value.length>0&&c.value.forEach(S=>{o.value[S.id]=!0}),u.value=l.visibleReport},Z=async()=>{await ee("getOrdersPickerAndReviewer","getOrdersPickerAndReviewer")},ue=async t=>{await ee("assingResponsible","assingResponsible",{responsible:t,id:f.value.id})},ee=async(t,l,m=null)=>{try{let a;m?a=await h[l](m):a=await h[t](),a.status==="success"&&b({status:"success",message:a.message,time:3e3})}catch(a){a.response?b({status:a.response.data.status,message:a.response.data.message,time:5e3}):console.log(a)}},ce=async()=>{if(s.value=!0,await w())try{let l=A.value.length==R.value.length,m={orderId:f.value.id,action:l,responsible:q.value,orderItemsProblem:c.value??[]},a=await h.processOrderAction(m);a.status=="success"&&J(),console.log(a),b({status:a.status,message:a.message})}catch(l){l.response&&b({status:l.response.data.status,message:l.response.data.message})}else s.value=!1,b({status:"info",message:"Proceso cancelado"})};return(t,l)=>{const m=fe("Toast");return p(),O(te,null,[i("div",Oe,[D.value?v("",!0):(p(),O("div",Ne,we)),F.value?v("",!0):(p(),O("div",De,[i("div",Te,[i("div",null,[i("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"},[Q(" Pickeo / Revisión "),i("a",{style:{cursor:"pointer"},onClick:le},Le)])]),r(ve,{onSearch:oe})]),D.value&&x.value.length>0?(p(),_(se,{key:0,title:"Aqui",type:e(g).METHOD_SHIPPING_HERE,orders:x.value,onAction:Y},null,8,["type","orders"])):v("",!0),D.value&&P.value.length>0||k.value.length>0?(p(),_(se,{key:1,title:"Retiro / Despacho",type:e(g).METHOD_SHIPPING_PICKUP_AND_DELIVERY,orders:[...P.value,...k.value],onAction:Y},null,8,["type","orders"])):v("",!0)])),F.value?(p(),O("div",$e,[i("div",Be,[i("h1",Fe,[He,Q(" Nota de venta N° "+T(f.value.DocNum)+" ",1),r(e(N),{icon:"pi pi-shopping-cart",value:f.value.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),Me,r(e(N),{icon:"pi pi-user",value:f.value.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),r(e(j),{tableStyle:"min-width: 50rem",filters:"filters",value:R.value},{default:y(()=>[r(e(d),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:y(a=>[i("p",null,T(a.data.Quantity)+" "+T(a.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),r(e(d),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),r(e(d),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),r(e(d),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),r(e(d),{headerClass:"!bg-primary-900",field:"id",header:""},{body:y(a=>[r(e(I),{icon:"pi pi-check-circle",onClick:S=>X(a.data,"complete"),label:"Completado",class:ae({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5 p-buttons-picker":E.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!E.value[a.data.id]}),outlined:!E.value[a.data.id]},null,8,["onClick","class","outlined"]),r(e(I),{icon:"pi pi-info-circle rotate-180",onClick:S=>X(a.data,"problem"),label:"Problema",class:ae({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5 p-buttons-picker":o.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!o.value[a.data.id]}),outlined:!o.value[a.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),i("div",Ve,[c.value.length>0?(p(),_(e(j),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:c.value,class:"teble-probelm"},{default:y(()=>[r(e(d),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),r(e(d),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),r(e(d),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:y(a=>[(p(!0),O(te,null,_e(a.data.problems,(S,pe)=>(p(),_(e(N),{key:pe,value:(S==null?void 0:S.other)||S.title,rounded:"",class:"my-2 mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):v("",!0)]),i("div",Ue,[r(e(I),{onClick:J,label:"Cancelar",class:"mr-4 !py-1.5 !px-10 p-button-outlined float-right !border-primary-900 !text-primary-900"}),r(e(I),{onClick:l[0]||(l[0]=a=>ce()),label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:s.value},null,8,["disabled"])])]),Ke,i("div",ze,[D.value&&P.value.length>0||k.value.length>0||x.value.length>0?(p(),_(me,{key:0,visible:e(h).visibleReport,"onUpdate:visible":l[1]||(l[1]=a=>e(h).visibleReport=a),product:C.value,problemsProduct:V.value,typeProblems:e(g).RESPONSIBLE_PICKER_REVIEWER,onSelectionChange:de,onVisible:ne},null,8,["visible","product","problemsProduct","typeProblems"])):v("",!0)])])):v("",!0)]),x.value.length===0&&P.value.length===0&&k.value?(p(),O("div",We,Qe)):v("",!0),r(m),r(e(Ce))],64)}}};export{st as default};
