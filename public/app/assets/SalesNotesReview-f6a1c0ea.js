import{v as Y,x as Z,W as D,X as j,e as l,k as ee,r as q,o as h,c as M,h as d,i as U,t as k,a as t,u as a,w as u,l as z,q as te,F,s as x,j as L,p as ae,C as se}from"./index-e5e99358.js";import{u as re}from"./OrdersApiService-9fb0d299.js";import{a as S,s as i,b as E}from"./tag.esm-9737e6e4.js";import{_ as le}from"./DialogReportProblem-ff80b955.js";import"./multiselect.esm-300f026b.js";import"./index.esm-587868b2.js";const oe={class:"px-8"},ie={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},de=d("i",{class:"pi pi-inbox !text-xl"},null,-1),ne=d("div",{class:"flex align-center mb-2"},null,-1),ce={class:"mini-table mt-8"},ue={class:"mt-8 flex float-right"},pe=d("div",{class:"space"},null,-1),ge={__name:"SalesNotesReview",setup(me){const K=Y(),Q=Z(),f=re(),w=D(),y=j(()=>w.params.id),N=j(()=>w.params.responsible),p=l([]),R=l([]),m=l([]),v=l([]),b=l([]),n=l(!1),I=l(!0),c=l([]),P=l([]),O=l([]);l([]),l([]);const $=l([]),A=new Set,_=new Set,W=new Set;ee(async()=>{p.value=await f.showOrder(y.value),m.value=p.value.order_items;let e={update_status:!0,responsible:N.value};await f.update(y.value,e)});const B=(e,s)=>{const o=W.add(e);if(e.id){const g=s==="complete"?A.add(e):A.delete(e);s==="complete"?(_.delete(e),c.value=Array.from(_)):$.value=e.problems,v.value[e.id]=s==="complete",b.value[e.id]=s!=="complete",n.value=s!=="complete",R.value=s!=="complete"?e:null,O.value=Array.from(o),I.value=O.value.length!==m.value.length,P.value=Array.from(g)}},X=({value:e,tempSelection:s})=>{e||(n.value=n.visibleReport,c.value=s)},G=(e,s)=>{console.log(e,s);let o=_.add(e);c.value=Array.from(o),n.value=s.visibleReport},H=async()=>{K.require({message:"¿Estas seguro que deseas continuar?",header:"Confirmación",icon:"pi pi-exclamation-triangle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",acceptLabel:"Si",rejectLabel:"No",accept:async()=>{let e=P.value.length==m.value.length,s={orderId:y.value,isSuccessOrder:e,responsible:N.value,orderItemsProblem:c.value??[]},o=await f.processOrderPickerAndReviewer(s);o.status=="success"&&(Q.add({severity:o.status,summary:"",detail:o.message,life:3e3}),setTimeout(()=>{window.location.href="/app/autorizador/pickeo-revision"},1e3))},reject:()=>{}})};return(e,s)=>{var T,V;const o=q("router-link"),g=q("Toast");return h(),M(F,null,[d("div",oe,[d("h1",ie,[de,U(" Nota de venta N° "+k(p.value.DocNum)+" ",1),t(a(S),{icon:"pi pi-shopping-cart",value:(T=p.value.method_shipping)==null?void 0:T.name,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),ne,t(a(S),{icon:"pi pi-user",value:(V=p.value.customer)==null?void 0:V.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),t(a(E),{tableStyle:"min-width: 50rem",filters:"filters",value:m.value},{default:u(()=>[t(a(i),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:u(r=>[d("p",null,k(r.data.qty)+" "+k(r.data.Quantity),1)]),_:1}),t(a(i),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),t(a(i),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),t(a(i),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),t(a(i),{headerClass:"!bg-primary-900",field:"id",header:""},{body:u(r=>[t(a(x),{icon:"pi pi-check-circle",onClick:C=>B(r.data,"complete"),label:"Completado",class:L({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5":v.value[r.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!v.value[r.data.id]}),outlined:!v.value[r.data.id]},null,8,["onClick","class","outlined"]),t(a(x),{icon:"pi pi-info-circle rotate-180",onClick:C=>B(r.data,"problem"),label:"Problema",class:L({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5":b.value[r.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!b.value[r.data.id]}),outlined:!b.value[r.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),d("div",ce,[c.value.length>0?(h(),z(a(E),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:c.value,class:"teble-probelm"},{default:u(()=>[t(a(i),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),t(a(i),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),t(a(i),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:u(r=>[(h(!0),M(F,null,ae(r.data.problems,(C,J)=>(h(),z(a(S),{key:J,value:C.title,rounded:"",class:"mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):te("",!0)]),d("div",ue,[t(o,{to:{name:"pickup-review"},class:"mr-3 p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},{default:u(()=>[U("Cancelar")]),_:1}),t(a(x),{onClick:H,label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:I.value},null,8,["disabled"])])]),pe,t(le,{visible:n.value,"onUpdate:visible":s[0]||(s[0]=r=>n.value=r),product:R.value,problemsProduct:$.value,typeProblems:"picker-revisor",onSelectionChange:G,onVisibleReport:X},null,8,["visible","product","problemsProduct"]),t(g),t(a(se))],64)}}};export{ge as default};
