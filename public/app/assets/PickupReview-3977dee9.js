import{s as u,a as N,b as j}from"./tag.esm-413a1352.js";import{C as me,a as ve,_ as be}from"./DialogReportProblem-5067926a.js";import{u as he}from"./OrdersApiService-6256fd65.js";import{e as n,l as re,o as p,c as O,h as d,t as T,a as r,w as h,u as e,i as Q,m as f,v,n as ge,s as I,x as ye,k as fe,r as _e,F as te,j as ae,p as Ce,z as Re}from"./index-52ced2bb.js";import{_ as ke,c as g,T as Ee}from"./FilterMultiSelect-edfcf773.js";import"./index.esm-1e56fb73.js";import"./ApiService-586aff42.js";import"./index.esm-c3c48359.js";import"./index.esm-b57a716a.js";const Se={key:0},xe={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},Pe={class:"flex"},se={__name:"DataTableOrdersPickerReview",props:{title:String,type:String,orders:Array},setup(M,{emit:V}){const b=M,w=n(b.orders);re(()=>b.orders,o=>{w.value=o});const _=o=>{w.value=o.orders},y=(o,i)=>{let s=C(o,i)!==void 0;V("action",{order:o,type:i,responsible:s})},C=(o,i)=>{var s;return(s=o.Responsibles.find(c=>c.pivot.task==i))==null?void 0:s.name};function R(o){const i=S(o);return(.299*i.r+.587*i.g+.114*i.b)/255>.5?"#000000":"#FFFFFF"}function S(o){const i=parseInt(o.substring(1),16),s=i>>16&255,c=i>>8&255,A=i&255;return{r:s,g:c,b:A}}return(o,i)=>b.orders.length>0?(p(),O("div",Se,[d("h2",xe,T(b.title),1),d("div",Pe,[r(ke,{typeOrders:b.type,allOrders:b.orders,onFilter:_},null,8,["typeOrders","allOrders"])]),r(e(j),{class:"mb-20",value:w.value,tableStyle:"min-width: 50rem",filters:"filters",paginator:"",rows:5,dataKey:"id",filterDisplay:"row",loading:o.loading,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:h(()=>[r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:h(s=>[Q(" N° "+T(s.data.DocNum),1)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocTime",header:"Hora"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:h(s=>[r(e(N),{Tag:"",icon:"pi pi-shopping-cart",value:s.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ResponsiblePickerName",header:"Picker"},{body:h(s=>[C(s.data,e(g).RESPONSIBLE_PICKER)?(p(),f(e(N),{key:0,icon:"pi pi-user",value:C(s.data,e(g).RESPONSIBLE_PICKER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):v("",!0)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ResponsibleReviewerName",header:"Revisor"},{body:h(s=>[C(s.data,e(g).RESPONSIBLE_REVIEWER)?(p(),f(e(N),{key:0,icon:"pi pi-user",value:C(s.data,e(g).RESPONSIBLE_REVIEWER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):v("",!0)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"OrderStatusName",header:"Estado"},{body:h(s=>[r(e(N),{icon:"pi pi-circle-fill",value:s.data.OrderStatusName,style:ge({backgroundColor:s.data.OrderStatusColor,color:R(s.data.OrderStatusColor)}),class:"tag-font-method tag-radius"},null,8,["value","style"])]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"note",header:""},{body:h(s=>[s.data.OrderStatusId!=e(g).ORDER_STATUS_REVIEWER?(p(),f(e(I),{key:0,label:"Piekear",onClick:c=>y(s.data,e(g).RESPONSIBLE_PICKER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):v("",!0),s.data.OrderStatusId==e(g).ORDER_STATUS_REVIEWER?(p(),f(e(I),{key:1,label:"Revisar",onClick:c=>y(s.data,e(g).RESPONSIBLE_REVIEWER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):v("",!0)]),_:1})]),_:1},8,["value","loading"])])):v("",!0)}};const Oe={class:"px-8"},Ne={key:0,class:"text-center",style:{color:"#259bd7"}},Ie=d("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),we=[Ie],De={key:1},Te={class:"flex justify-between"},Ae=d("i",{class:"pi pi-refresh"},null,-1),Le=[Ae],$e={key:2},Be={class:"px-8"},Fe={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},Me=d("i",{class:"pi pi-inbox !text-xl"},null,-1),Ve=d("div",{class:"flex align-center mb-2"},null,-1),He={class:"mini-table mt-8"},Ue={class:"mt-8 flex float-right"},Ke=d("div",{class:"space"},null,-1),We={key:0,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},ze=d("h1",{class:"align-center font-inter font-semibold mb-4 text-2xl text-center text-primary-900"}," No se han encontrado ordenes ",-1),je=[ze],at={__name:"PickupReview",props:{wareHouseCode:String},setup(M){const V=M,{showToast:b}=Ee.setup(),{showConfirm:w}=me.setup(),_=he(),y=n([]),C=n([]),R=n([]),S=n([]),o=n([]),i=n(!1),s=n(!0),c=n([]),A=n([]),L=n([]),H=n([]),U=new Set,$=new Set,B=new Set,D=n(!1),F=n(!1),q=n(""),x=n([]),P=n([]),k=n([]),{listOrdersHere:K,listOrdersPickup:W,listOrdersDelivery:G}=ye(_.$state),le=()=>{Z()};re(()=>_.orders,t=>{x.value=K.value,P.value=W.value,k.value=G.value}),fe(()=>{try{_.wareHouseCode=V.wareHouseCode,Z(),x.value=K.value,P.value=W.value,k.value=G.value,D.value=!0}catch(t){console.error("Error fetching orders:",t)}});const oe=t=>{x.value=z(K.value,t),P.value=z(W.value,t),k.value=z(k.value,t)};function z(t,l){return t.filter(m=>m.DocNum.toString().includes(l.value.toString())||m.Customer.CardName.toLowerCase().includes(l.value.toLowerCase()))}const Y=t=>{F.value=!0,y.value=t.order,R.value=t.order.OrderItems,q.value=t.type,t.responsible||ue(t.type)},J=()=>{F.value=!1,ie()},ie=()=>{B.clear(),U.clear(),$.clear(),s.value=!0,c.value=[],H.value=[],R.value.forEach(t=>{o.value[t.id]=!1,S.value[t.id]=!1})},X=(t,l)=>{const m=l==="complete"?B.add(t):B.delete(t);if(t.id){const a=l==="complete"?U.add(t):U.delete(t);l==="complete"?(o.value[t.id]=!1,$.delete(t),c.value=Array.from($)):H.value=t.problems,S.value[t.id]=l==="complete",i.value=l!=="complete",C.value=l!=="complete"?t:null,L.value=Array.from(m),s.value=L.value.length!==R.value.length,A.value=Array.from(a)}},ne=({value:t,tempSelection:l})=>{t||(i.value=i.visibleReport,c.value=l)},de=(t,l)=>{t.problems=l.listProblems;let m=B.add(t);L.value=Array.from(m);let a=$.add(t);c.value=Array.from(a),s.value=L.value.length!==R.value.length,c.value.length>0&&c.value.forEach(E=>{o.value[E.id]=!0}),i.value=l.visibleReport},Z=async()=>{await ee("getOrdersPickerAndReviewer","getOrdersPickerAndReviewer")},ue=async t=>{await ee("assingResponsible","assingResponsible",{responsible:t,id:y.value.id})},ee=async(t,l,m=null)=>{try{let a;m?a=await _[l](m):a=await _[t](),a.status==="success"&&b({status:"success",message:"Operación exitosa",time:3e3})}catch(a){a.response?b({status:a.response.data.status,message:a.response.data.message,time:5e3}):console.log(a)}},ce=async()=>{if(s.value=!0,await w())try{let l=A.value.length==R.value.length,m={orderId:y.value.id,action:l,responsible:q.value,orderItemsProblem:c.value??[]},a=await _.processOrderAction(m);a.status=="success"&&J(),console.log(a),b({status:a.status,message:a.message})}catch(l){l.response&&b({status:l.response.data.status,message:l.response.data.message})}else s.value=!1,b({status:"info",message:"Proceso cancelado"})};return(t,l)=>{const m=_e("Toast");return p(),O(te,null,[d("div",Oe,[D.value?v("",!0):(p(),O("div",Ne,we)),F.value?v("",!0):(p(),O("div",De,[d("div",Te,[d("div",null,[d("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"},[Q(" Pickeo / Revisión "),d("a",{style:{cursor:"pointer"},onClick:le},Le)])]),r(be,{onSearch:oe})]),D.value&&x.value.length>0?(p(),f(se,{key:0,title:"Aqui",type:e(g).METHOD_SHIPPING_HERE,orders:x.value,onAction:Y},null,8,["type","orders"])):v("",!0),D.value&&P.value.length>0||k.value.length>0?(p(),f(se,{key:1,title:"Retiro / Despacho",type:e(g).METHOD_SHIPPING_PICKUP_AND_DELIVERY,orders:[...P.value,...k.value],onAction:Y},null,8,["type","orders"])):v("",!0)])),F.value?(p(),O("div",$e,[d("div",Be,[d("h1",Fe,[Me,Q(" Nota de venta N° "+T(y.value.DocNum)+" ",1),r(e(N),{icon:"pi pi-shopping-cart",value:y.value.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),Ve,r(e(N),{icon:"pi pi-user",value:y.value.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),r(e(j),{tableStyle:"min-width: 50rem",filters:"filters",value:R.value},{default:h(()=>[r(e(u),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:h(a=>[d("p",null,T(a.data.Quantity)+" "+T(a.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),r(e(u),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),r(e(u),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),r(e(u),{headerClass:"!bg-primary-900",field:"id",header:""},{body:h(a=>[r(e(I),{icon:"pi pi-check-circle",onClick:E=>X(a.data,"complete"),label:"Completado",class:ae({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5 p-buttons-picker":S.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!S.value[a.data.id]}),outlined:!S.value[a.data.id]},null,8,["onClick","class","outlined"]),r(e(I),{icon:"pi pi-info-circle rotate-180",onClick:E=>X(a.data,"problem"),label:"Problema",class:ae({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5 p-buttons-picker":o.value[a.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!o.value[a.data.id]}),outlined:!o.value[a.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),d("div",He,[c.value.length>0?(p(),f(e(j),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:c.value,class:"teble-probelm"},{default:h(()=>[r(e(u),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),r(e(u),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),r(e(u),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:h(a=>[(p(!0),O(te,null,Ce(a.data.problems,(E,pe)=>(p(),f(e(N),{key:pe,value:(E==null?void 0:E.other)||E.title,rounded:"",class:"my-2 mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):v("",!0)]),d("div",Ue,[r(e(I),{onClick:J,label:"Cancelar",class:"mr-4 !py-1.5 !px-10 p-button-outlined float-right !border-primary-900 !text-primary-900"}),r(e(I),{onClick:l[0]||(l[0]=a=>ce()),label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:s.value},null,8,["disabled"])])]),Ke,D.value&&P.value.length>0||k.value.length>0||x.value.length>0?(p(),f(ve,{key:0,visible:i.value,"onUpdate:visible":l[1]||(l[1]=a=>i.value=a),product:C.value,problemsProduct:H.value,typeProblems:e(g).RESPONSIBLE_PICKER_AND_REVIEWER,onSelectionChange:de,onVisible:ne},null,8,["visible","product","problemsProduct","typeProblems"])):v("",!0)])):v("",!0)]),x.value.length===0&&P.value.length===0&&k.value?(p(),O("div",We,je)):v("",!0),r(m),r(e(Re))],64)}}};export{at as default};
