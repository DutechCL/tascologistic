import{s as z,a as Q}from"./tabpanel.esm-e58cc136.js";import{c as h,_ as Y,T as K,a as W}from"./FilterMultiSelect-796a38e0.js";import{k as J,e as c,o as l,l as v,w as _,h as r,i as T,t as S,u as e,a as o,c as x,F as E,m as V,s as I,p as U,q as f,v as q,x as $,f as X,r as Z,y as ee}from"./index-c880184c.js";import{a as R,b as A,s as y}from"./tag.esm-f51f7c2c.js";import{u as te}from"./OrdersApiService-706b4dba.js";import{u as re,s as ae}from"./ProblemsApiService-db52eb7b.js";import{C as se}from"./ConfirmMixin-c64e0a1d.js";import"./index.esm-63a5631d.js";import"./index.esm-d2e2b394.js";import"./ApiService-418896ba.js";const B=te(),H=J("ordersCda",{state:()=>({listOrders:[],listOrdersManage:[],order:[],showDialog:!1,typeDialog:"",currentOrder:{orderId:null,action:"",responsible:h.RESPONSIBLE_CDA,problems:"",anotherProblem:""}}),getters:{orders:m=>m.listOrders},actions:{async getOrdersCdaToManager(){let m=await B.getOrdersCdaToManager();this.listOrders=m.data},async getOrdersCdaManage(){let m=await B.getOrdersCdaManage();this.listOrdersManage=m.data},async processOrderCda(){let m=await B.processOrderCda(this.currentOrder);return this.listOrders=m.data,m}}});const oe=r("h1",{class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-eye !text-xl"}),T(" Ver Documentos ")],-1),le={class:"flex align-center mb-2"},ne={class:"text-primary-900"},ie=r("strong",{class:"mr-3 font-semibold"},"Nota de venta N°",-1),de={class:"mt-5"},ue=r("p",null," 2 archivos adjuntos ",-1),ce={class:"flex"},pe={class:"mt-2 mr-5 relative",width:"200",height:"180"},me=["src"],ge={class:"bg-gray-100"},_e=r("i",{class:"pi pi-file-pdf m-2",style:{color:"#F40F02"}},null,-1),be={class:"font-normal text-sm"},he=["href"],ve={__name:"DialogDetail",setup(m){const d=H(),t=c([{name:"Documento 1",url:"http://ocw.uv.es/ingenieria-y-arquitectura/programacionmultimedia/t2-1-css.pdf"},{name:"Documento 2",url:"http://ocw.uv.es/ingenieria-y-arquitectura/programacionmultimedia/t2-1-css.pdf"}]);return(p,i)=>(l(),v(e(U),{modal:"",header:" ",style:{width:"70vw"},maximizable:""},{default:_(()=>[r("div",null,[oe,r("div",le,[r("p",ne,[ie,T(S(e(d).order.DocNum),1)]),o(e(R),{icon:"pi pi-shopping-bag",value:e(d).order.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),o(e(R),{icon:"pi pi-user",value:e(d).order.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]),r("div",de,[ue,r("div",ce,[(l(!0),x(E,null,V(t.value,a=>(l(),x("div",pe,[r("embed",{class:"w-full",src:a.url,type:"application/pdf"},null,8,me),r("div",ge,[_e,r("span",be,S(a.name),1)]),r("a",{class:"mask-pdf",href:a.url,target:"_blank"},null,8,he)]))),256))])])]),o(e(I),{label:"Cerrar",onClick:i[0]||(i[0]=a=>e(d).showDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]),_:1}))}},ye=r("h1",{class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-eye !text-xl"}),T(" Ver observaciones ")],-1),fe={class:"flex align-center mb-2"},Oe={class:"text-primary-900"},Pe=r("strong",{class:"mr-3 font-semibold"},"Nota de venta N°",-1),De=["innerHTML"],Ce={class:"mt-5"},xe=r("strong",null,"NOTA:",-1),Me=r("br",null,null,-1),Ne=["innerHTML"],ke={__name:"DialogDetailObservation",setup(m){const d=H(),t=i=>new DOMParser().parseFromString(i,"text/html").body.innerText,p=i=>i.replace(/\r/g,"<br>").replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");return(i,a)=>(l(),v(e(U),{modal:"",header:" ",style:{width:"70vw"},maximizable:""},{default:_(()=>{var g,O;return[r("div",null,[ye,r("div",fe,[r("p",Oe,[Pe,T(S(e(d).order.DocNum),1)]),o(e(R),{icon:"pi pi-shopping-cart",value:e(d).order.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),o(e(R),{icon:"pi pi-user",value:e(d).order.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),e(d).order.HasProblems?f("",!0):(l(),v(e(A),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:e(d).order.OrderItems,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:_(()=>[o(e(y),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:_(n=>[r("p",null,S(n.data.Quantity)+" "+S(n.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),o(e(y),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),o(e(y),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),o(e(y),{headerClass:"!bg-primary-900",field:"Problems",header:"Problema"},{body:_(n=>[(l(!0),x(E,null,V(n.data.Problems,(D,C)=>(l(),x("p",{class:"mt-2 mr-3 tag-radius tag-rounded-blue tag-font-method",key:C},S(t(D.ProblemName)),1))),128))]),_:1})]),_:1},8,["value"])),r("div",null,[(g=e(d).order)!=null&&g.HasProblems?(l(),v(e(A),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:(O=e(d).order)==null?void 0:O.Problems},{default:_(()=>[o(e(y),{headerClass:"!bg-primary-900",field:"ProblemName",header:"Probelma"},{body:_(n=>[r("p",null,S(n.data.ProblemName),1)]),_:1}),o(e(y),{headerClass:"!bg-primary-900",field:"Other",header:"Descripcion"},{body:_(n=>[r("p",{innerHTML:n.data.Other},null,8,De)]),_:1})]),_:1},8,["value"])):f("",!0)]),r("div",Ce,[xe,T(),Me,T(),r("span",{innerHTML:p(e(d).order.Comments)},null,8,Ne)])]),o(e(I),{label:"Cerrar",onClick:a[0]||(a[0]=n=>e(d).showDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]}),_:1}))}},we=r("h1",{class:"mb-3 mt-3 text-primary-900 font-inter font-semibold text-xl"},[r("i",{class:"pi pi-info-circle !text-xl rotate-180"}),T(" Reportar problema ")],-1),Se=r("p",{class:"mb-3"},"Por favor indique uno o más problemas detectados",-1),Te={key:0,class:"mt-4"},$e=r("p",{class:"mb-3"},"Por favor indique el problema detectado",-1),Ie={__name:"DialogReportProblem",props:{order:Object,product:Object,typeProblems:String,problemsProduct:Object},setup(m,{emit:d}){const t=m,p=re(),i=H(),a=c([]),g=c([]),O=c(!1),n=c(null),D=c(null),C=c(!0),b=c(!1),N=c(!1),u=c(!1),s=c([]);q(async()=>{await p.getProblems(t.typeProblems),a.value=p.problems});const k=()=>{C.value=!0,b.value=!1,g.value=[],n.value=""};$(()=>t.order,P=>{s.value=P,t.typeProblems==h.RESPONSIBLE_CDA&&(g.value=[])});const w=()=>{C.value=!0,t.typeProblems==h.RESPONSIBLE_CDA&&(i.currentOrder.action="reject",i.currentOrder.orderId=t.order.id,i.currentOrder.problems=g.value,i.currentOrder.other=n.value,d("processOrder"))};$(()=>t.problemsProduct,P=>{P!=null&&(g.value=[...P],u.value=P.length>0,P.map(M=>{M.title==="Otro"&&(n.value=M.other,b.value=!!F(n.value).trim())}))}),$(g,P=>{O.value=P.some(M=>M.title==="Otro"),C.value=P.length===0||O.value&&!b.value,t.typeProblems===h.RESPONSIBLE_PICKER_REVIEWER&&(D.value=t.product,N.value||(D.value.problems=P))}),$(n,()=>{O.value?(b.value=!!F(n.value).trim(),C.value=!b.value):C.value=!1});const F=P=>new DOMParser().parseFromString(P,"text/html").body.innerText;return(P,M)=>(l(),v(e(U),{modal:"",header:" ",style:{width:"70vw"},"onUpdate:visible":k},{default:_(()=>[r("div",null,[we,Se,o(e(A),{selection:g.value,"onUpdate:selection":M[0]||(M[0]=L=>g.value=L),value:a.value,dataKey:"id"},{default:_(()=>[o(e(y),{headerClass:"!bg-primary-900",header:"Seleccionar",selectionMode:"multiple"}),o(e(y),{headerClass:"!bg-primary-900",field:"title",header:"Problema detectado"})]),_:1},8,["selection","value"]),O.value?(l(),x("div",Te,[$e,o(e(ae),{class:"custom-editor",modelValue:n.value,"onUpdate:modelValue":M[1]||(M[1]=L=>n.value=L),editorStyle:"height: 80px"},null,8,["modelValue"])])):f("",!0)]),r("div",null,[o(e(I),{label:"Reportar",disabled:C.value,onClick:w,class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"},null,8,["disabled"])])]),_:1}))}},Ee={key:0,class:"pb-10"},Re={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},He={class:"flex"},G={__name:"DataTableOrdersCda",props:{title:String,type:String,orders:Array,toManage:Boolean,totalOrders:Number},setup(m,{emit:d}){const t=m,p=H(),i=c(t.orders),a=c({here:[{label:"Ver observación",value:"observation"}],"pickup-delivery":[{label:"Var documentos",value:"detail"}]}),g=c({here:[{label:"Informado",value:h.ACTION_INFO}],"pickup-delivery":[{label:"Rechazar",value:"reportProblem"},{label:"Autorizar",value:h.ACTION_APPROVE}]}),O=c(["DocNum","Customer","DocTotal","DocTime","DocDate"]);$(()=>t.orders,()=>{i.value=t.orders});const n=b=>{console.log(b)},D=(b,N)=>{if([h.ACTION_INFO,h.ACTION_APPROVE].includes(b)){p.currentOrder.orderId=N.id,p.currentOrder.action=b,d("processOrder");return}p.order=N,p.showDialog=!0,p.typeDialog=b},C=b=>{i.value=b.orders};return(b,N)=>i.value.length>0?(l(),x("div",Ee,[r("div",null,[r("h2",Re,S(t.title),1)]),r("div",He,[o(Y,{allOrders:t.orders,typeOrders:t.type,filters:O.value,onFilter:C},null,8,["allOrders","typeOrders","filters"])]),o(e(A),{value:i.value,rowsPerPageOptions:[5,10,20,50],rows:5,onPage:n,paginator:"",dataKey:"id",filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:_(()=>[o(e(y),{headerClass:"!bg-primary-900",field:"DocNum",header:"Nota de venta",sortable:""},{body:_(u=>[T(" N° "+S(u.data.DocNum),1)]),_:1}),o(e(y),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),o(e(y),{headerClass:"!bg-primary-900",sortable:"",field:"DocTime",header:"Hora"}),o(e(y),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente"}),o(e(y),{headerClass:"!bg-primary-900",sortable:"",field:"DocTotal",header:"Monto total"}),o(e(y),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:_(u=>[t.type==e(h).METHOD_SHIPPING_HERE?(l(),v(e(R),{key:0,Tag:"",icon:"pi pi-shopping-cart",value:u.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])):f("",!0),t.type==e(h).METHOD_SHIPPING_PICKUP_AND_DELIVERY?(l(),v(e(R),{key:1,Tag:"",icon:u.data.method_shipping_id===e(h).METHOD_SHIPPING_PICKUP_ID?"pi pi-home":"pi pi-truck",value:u.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["icon","value"])):f("",!0)]),_:1}),o(e(y),{headerClass:"!bg-primary-900",field:"note",header:"Documentos"},{body:_(u=>[(l(!0),x(E,null,V(a.value[t.type],s=>(l(),v(e(I),{icon:"pi pi-eye",onClick:k=>D(s.value,u.data),class:"!font-normal !text-primary-900",label:s.label,link:""},null,8,["onClick","label"]))),256))]),_:1}),t.toManage?f("",!0):(l(),v(e(y),{key:0,headerClass:"!bg-primary-900",field:"note",header:"Observación"},{body:_(u=>[u.data.HasProblems?(l(),v(e(I),{key:0,icon:"pi pi-eye",onClick:s=>D("observation",u.data),class:"!font-normal !text-primary-900",label:"Ver observación",link:""},null,8,["onClick"])):f("",!0)]),_:1})),t.toManage?(l(),v(e(y),{key:1,headerClass:"!bg-primary-900",field:"note",header:""},{body:_(u=>[(l(!0),x(E,null,V(g.value[t.type],s=>(l(),v(e(I),{label:s.label,onClick:k=>D(s.value,u.data),class:"!py-1.5 mr-3 !border-primary-900 !text-primary-900",outlined:""},null,8,["label","onClick"]))),256))]),_:1})):f("",!0)]),_:1},8,["value"])])):f("",!0)}};const Le={class:"flex justify-between"},Ve=r("i",{class:"pi pi-refresh"},null,-1),Ae=[Ve],Be={key:4,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},Ue=r("h1",{class:"align-center font-inter font-semibold mb-4 text-2xl text-center text-primary-900"}," No se han encontrado ordenes ",-1),Fe=[Ue],j={__name:"ToManage",props:{toManage:Boolean,orders:Array},setup(m,{emit:d}){const t=m,{showToast:p}=K.setup(),{showConfirm:i}=se.setup(),a=H(),g=c([]),O=c([]),n=c(h.RESPONSIBLE_CDA+":"+t.toManage),D=async()=>{d("updateOrders")};X(async()=>{b(t.orders)});const C=u=>{b(u.orders)};$(()=>t.orders,()=>{b(t.orders)});const b=u=>{g.value=u.filter(s=>s.method_shipping_id===h.METHOD_SHIPPING_HERE_ID).sort((s,k)=>new Date(k.updated_at)-new Date(s.updated_at)),O.value=u.filter(s=>s.method_shipping_id!==h.METHOD_SHIPPING_HERE_ID).sort((s,k)=>new Date(k.updated_at)-new Date(s.updated_at))},N=async()=>{if(await i())try{let s=await a.processOrderCda();s.status==="success"&&(a.showDialog=!1,p({status:s.status,message:s.message}),a.getOrdersCdaManage())}catch(s){s.response&&p({status:s.response.data.status,message:s.response.data.message})}else p({status:"info",message:"Proceso cancelado"})};return(u,s)=>{const k=Z("DialogaddObservation");return l(),x(E,null,[r("div",Le,[r("div",null,[r("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"},[T(" Notas de venta "),r("a",{style:{cursor:"pointer"},onClick:D},Ae)])]),o(W,{type:n.value,orders:t.orders,onSearch:C},null,8,["type","orders"])]),o(G,{title:"Aquí",type:e(h).METHOD_SHIPPING_HERE,totalOrders:t.totalOrders,orders:g.value,toManage:m.toManage,onProcessOrder:N},null,8,["type","totalOrders","orders","toManage"]),o(G,{title:"Retiro / Despacho",type:e(h).METHOD_SHIPPING_PICKUP_AND_DELIVERY,totalOrders:t.totalOrders,orders:O.value,toManage:m.toManage,onProcessOrder:N},null,8,["type","totalOrders","orders","toManage"]),e(a).typeDialog==="detail"?(l(),v(ve,{key:0,visible:e(a).showDialog,"onUpdate:visible":s[0]||(s[0]=w=>e(a).showDialog=w),order:e(a).order},null,8,["visible","order"])):f("",!0),e(a).typeDialog==="observation"?(l(),v(ke,{key:1,visible:e(a).showDialog,"onUpdate:visible":s[1]||(s[1]=w=>e(a).showDialog=w),order:e(a).order},null,8,["visible","order"])):f("",!0),e(a).typeDialog==="reportProblem"?(l(),v(Ie,{key:2,visible:e(a).showDialog,"onUpdate:visible":s[2]||(s[2]=w=>e(a).showDialog=w),typeProblems:e(h).RESPONSIBLE_CDA,order:e(a).order,onProcessOrder:N},null,8,["visible","typeProblems","order"])):f("",!0),e(a).typeDialog==="addObservation"?(l(),v(k,{key:3,visible:e(a).showDialog,"onUpdate:visible":s[3]||(s[3]=w=>e(a).showDialog=w),typeProblems:e(h).RESPONSIBLE_CDA,order:e(a).order,disabled:!0},null,8,["visible","typeProblems","order"])):f("",!0),g.value.length===0&&O.value.length===0?(l(),x("div",Be,Fe)):f("",!0)],64)}}};const ze={class:"px-3"},Ge={key:0,class:"text-center",style:{color:"#259bd7"}},je=r("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),Ke=[je],at={__name:"SalesNotes",setup(m){const{showToast:d}=K.setup(),t=H(),p=c([]),i=c([]),a=c(!1);q(()=>{t.getOrdersCdaToManager().then(()=>{p.value=t.listOrders}),t.getOrdersCdaManage().then(()=>{i.value=t.listOrdersManage}),a.value=!0});const g=()=>{t.getOrdersCdaToManager().then(()=>{p.value=t.listOrders}),t.getOrdersCdaManage().then(()=>{i.value=t.listOrdersManage}),d({status:"success",title:"Ordenes actualizadas",message:"Las ordenes se han actualizado correctamente"})};return $(()=>[t.listOrders,t.listOrdersManage],()=>{p.value=t.listOrders,i.value=t.listOrdersManage}),(O,n)=>(l(),x(E,null,[r("div",ze,[o(e(Q),{modelValue:O.selectedTab,"onUpdate:modelValue":n[0]||(n[0]=D=>O.selectedTab=D)},{default:_(()=>[o(e(z),{header:"Por gestionar"},{default:_(()=>[a.value?f("",!0):(l(),x("div",Ge,Ke)),a.value?(l(),v(j,{key:1,toManage:!0,orders:p.value,onUpdateOrders:g},null,8,["orders"])):f("",!0)]),_:1}),o(e(z),{header:"Gestionadas"},{default:_(()=>[a.value?(l(),v(j,{key:0,toManage:!1,orders:i.value,onUpdateOrders:g},null,8,["orders"])):f("",!0)]),_:1})]),_:1},8,["modelValue"])]),o(e(ee))],64))}};export{at as default};
