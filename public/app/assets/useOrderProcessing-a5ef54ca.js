import{y as R,e as v,o as g,k as b,w as n,h as p,t as _,a as s,u as e,p as S,c as $,l as H,F as L,s as w,m as F,i as x,v as A}from"./index-d9ee75a5.js";import{s as c,b as N,a as C}from"./tag.esm-1fdd9b40.js";import{_ as z}from"./FilterMultiSelect-6535a61d.js";import{c as k,T as G,C as K}from"./ConfirmMixin-d0af86ec.js";import{u as j}from"./OrdersApiService-bfb964b1.js";const B=j(),E=R("ordersBills",{state:()=>({listOrders:[],order:[],visibleDialog:!1,orderProcessingStatus:{},bill:{},visibleBill:!1}),getters:{orders:r=>r.listOrders},actions:{async getOrdersBillPickupAndHere(){let r=await B.getOrdersBillPickupAndHere();this.listOrders=r.data},async getOrdersBillDelivery(){let r=await B.getOrdersBillDelivery();this.listOrders=r.data},async processOrderBiller(r){let o=await B.processOrderBiller(r);return o.data.order_status_id===k.ORDER_STATUS_BILLED?this.listOrders=this.listOrders.filter(l=>l.id!==o.data.id):this.listOrders=this.listOrders.map(l=>l.id===o.data.id?o.data:l),o},showDetailOrder(r){this.order=r,this.visibleDialog=!0},showDetailBiller(r){this.bill=r.bill,this.visibleBill=!0}}}),Q=p("h1",{class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},[p("i",{class:"pi pi-eye !text-xl"}),x(" Ver detalles ")],-1),q=p("div",{class:"mt-2 mb-1 text-primary-900 font-semi-bold"},[p("p",null,"Productos")],-1),se={__name:"DialogDetail",setup(r){var y;const o=E(),l=v(o.order),u=v((y=o.order)==null?void 0:y.OrderItems),m=O=>{switch(O.pivot.task){case"reviewer":return"Revisado por:";case"picker":return"Preparado por";case"cda":return"Autorizado por"}};return(O,D)=>(g(),b(e(F),{modal:"",header:" ",maximizable:"",style:{width:"70vw"}},{default:n(()=>[p("div",null,[Q,p("p",null,"Revisa aquí los detalles de la nota de venta N° "+_(l.value.DocNum),1)]),q,s(e(N),{tableStyle:"min-width: 50rem",filters:"filters",value:u.value},{default:n(()=>[s(e(c),{headerClass:"!bg-primary-900",field:"date",header:"Cantidad"},{body:n(t=>[p("p",null,_(t.data.Quantity)+" "+_(t.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),s(e(c),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),s(e(c),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),s(e(c),{headerClass:"!bg-primary-900",field:"WarehouseCode",header:"Bodega"}),s(e(c),{headerClass:"!bg-primary-900",field:"U_SBO_StockVentas",header:"Stock Ventas"},{body:n(t=>[p("p",null,_(t.data.U_SBO_StockVentas)+" "+_(t.data.U_SBO_StockVentas>1?"Unidades":"Unidad"),1)]),_:1})]),_:1},8,["value"]),s(e(N),{class:"pt-5",tableStyle:"min-width: 50rem",value:[l.value]},{default:n(()=>[s(e(c),{headerClass:"!bg-primary-900",field:"SalesEmployeeName",header:"Vendedor"},{body:n(t=>{var f,d;return[(f=t.data)!=null&&f.SalesEmployeeName?(g(),b(e(C),{key:0,icon:"pi pi-user",value:(d=t.data)==null?void 0:d.SalesEmployeeName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):S("",!0)]}),_:1}),(g(!0),$(L,null,H(l.value.Responsibles,t=>(g(),b(e(c),{headerClass:"!bg-primary-900",field:"responsible",header:m(t)},{body:n(f=>[t.name?(g(),b(e(C),{key:0,icon:"pi pi-user",value:t.name,class:"p-tag-1 tag-font-method tag-radius"},null,8,["value"])):S("",!0)]),_:2},1032,["header"]))),256))]),_:1},8,["value"]),s(e(w),{label:"Cerrar",onClick:D[0]||(D[0]=t=>e(o).visibleDialog=!1),class:"!py-2 !border-none !px-10 !bg-primary-900 float-right mt-5"})]),_:1}))}};const W={key:0},Y={class:"flex"},te={__name:"DataTableOrders",props:{type:String,actions:Object,orders:Object},setup(r,{emit:o}){const l=r,u=E(),m=v(l.orders),y=v(l.orders),O=v(["DocNum","Customer","DocTotal","DocTime","DocDate"]),D=d=>{switch(d.method_shipping_id){case k.METHOD_SHIPPING_DELIVERY_ID:return"pi pi-truck";case k.METHOD_SHIPPING_PICKUP_ID:return"pi pi-home";case k.METHOD_SHIPPING_HERE_ID:return"pi pi-shopping-cart";default:return"pi pi-shopping-cart"}},t=(d,i,a=null)=>{o("action",{method:d,document:a,responsible:"biller",order:i})},f=d=>{m.value=d.orders};return A(()=>l.orders,d=>{m.value=d,y.value=d}),(d,i)=>m.value.length>0?(g(),$("div",W,[p("div",Y,[s(z,{typeOrders:"here",allOrders:y.value,filters:O.value,onFilter:f},null,8,["allOrders","filters"])]),s(e(N),{tableStyle:"min-width: 50rem",filters:"filters",value:m.value,paginator:"",rowsPerPageOptions:[5,10,20,50],rows:5,dataKey:"id",filterDisplay:"row",loading:d.loading,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:n(()=>[s(e(c),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:n(a=>[x(" N° "+_(a.data.DocNum),1)]),_:1}),s(e(c),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),s(e(c),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente",style:{"max-width":"300px"}}),s(e(c),{headerClass:"!bg-primary-900",sortable:"",field:"DocTotal",header:"Monto total"}),s(e(c),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:n(a=>[s(e(C),{icon:D(a.data),value:a.data.MethodShippingName,class:"p-tag-1 tag-font-method tag-radius"},null,8,["icon","value"])]),_:1}),s(e(c),{headerClass:"!bg-primary-900",field:"note",header:"Detalles"},{body:n(a=>[s(e(w),{icon:"pi pi-eye",onClick:h=>t("showDetailOrder",a.data),class:"!text-primary-900",label:"Ver detalles",link:""},null,8,["onClick"])]),_:1}),s(e(c),{headerClass:"!bg-primary-900",field:"client",header:"Emitir"},{body:n(a=>{var h,I,T,M;return[(h=e(u).orderProcessingStatus[a.data.id])!=null&&h.inProcess?(I=e(u).orderProcessingStatus[a.data.id])!=null&&I.inProcess?(g(),b(e(C),{key:1,severity:(T=e(u).orderProcessingStatus[a.data.id])==null?void 0:T.severity,icon:(M=e(u).orderProcessingStatus[a.data.id])==null?void 0:M.icon,class:"tag-font-method tag-radius"},{default:n(()=>{var P,V;return[p("span",null,_((P=e(u).orderProcessingStatus[a.data.id])==null?void 0:P.status),1),((V=e(u).orderProcessingStatus[a.data.id])==null?void 0:V.severity)==="success"?(g(),b(e(w),{key:0,onClick:J=>{var U;return t("showDetailBill",(U=e(u).orderProcessingStatus[a.data.id])==null?void 0:U.order)},class:"show-bill-details",link:""},{default:n(()=>[x(" Ver ")]),_:2},1032,["onClick"])):S("",!0)]}),_:2},1032,["severity","icon"])):S("",!0):(g(),b(e(w),{key:0,label:a.data.U_SBO_FormaPago,onClick:P=>t("processOrderBiller",a.data,a.data.U_SBO_FormaPago),class:"!py-1.5 !border-primary-900 !text-primary-900 mr-3",severity:"primary",style:{width:"100px"},outlined:""},null,8,["label","onClick"]))]}),_:1})]),_:1},8,["value","loading"])])):S("",!0)}};function ie(){const r=E(),o=v([]),{showToast:l}=G.setup(),{showConfirm:u}=K.setup(),m=v(!1),y=i=>{o.value=i.orders},O=i=>{switch(i.method){case"showDetailOrder":r.showDetailOrder(i.order);break;case"showDetailBill":r.showDetailBiller(i.order);break;case"processOrderBiller":f(i);break}},D=async i=>{i==="delivery"?await r.getOrdersBillDelivery():await r.getOrdersBillPickupAndHere(),l({status:"success",message:"Ordenes actualizadas",time:3e3})},t=()=>{o.value.length===0&&(window.location.href="/admin/dashboard/")},f=async i=>{try{if(await u()){r.orderProcessingStatus[i.order.id]={inProcess:!0,status:"Procesando...",severity:"info",icon:"pi pi-spin pi-spinner"};let h=await r.processOrderBiller(i);h.status==="success"&&(r.orderProcessingStatus[i.order.id]={inProcess:!0,status:"Documento Emitido",severity:"success",icon:"pi pi-check",order:h.data},l({status:"success",message:h.message}))}else l({status:"info",message:"Proceso cancelado"})}catch(a){r.orderProcessingStatus[i.order.id]={inProcess:!0,status:"Error al emitir el documento",severity:"danger",icon:"pi pi-times"},a.response.status==401&&o.value.filter(h=>h.id!==a.response.data.data.id),l({status:"error",message:a.response.data.message})}};return{orders:o,updateOrders:D,visible:m,visibleDetailsMethod:i=>{m.value=i.visibleDetails},actionMethod:O,goBack:t,search:y,orderStore:r}}export{te as _,se as a,E as b,ie as u};
