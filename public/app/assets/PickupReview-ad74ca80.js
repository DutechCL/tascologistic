import{s as n,a as R,b as L}from"./tag.esm-a3c22367.js";import{a as le,c as b,T as oe,C as ie,b as ne,_ as de}from"./FilterMultiSelect-39533e63.js";import{u as ue}from"./OrdersApiService-9a584736.js";import{e as i,o as u,c as E,h as c,t as w,a as t,w as p,u as e,i as Y,m as _,v as m,n as ce,s as x,x as pe,k as me,r as ve,j as G,F as be,p as he,z as ye}from"./index-193ecf8e.js";import"./index.esm-f527573d.js";import"./index.esm-3a02ba19.js";const ge={key:0},_e={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},fe={class:"flex"},Q={__name:"DataTableOrdersPickerReview",props:{title:String,type:String,orders:Array},setup(V,{emit:N}){const f=V,C=i(f.orders),g=l=>{C.value=l.orders},O=(l,d)=>{N("action",{order:l,type:d})},h=(l,d)=>{var a;return(a=l.Responsibles.find(y=>y.role_slug==d))==null?void 0:a.name};function S(l){const d=k(l);return(.299*d.r+.587*d.g+.114*d.b)/255>.5?"#000000":"#FFFFFF"}function k(l){const d=parseInt(l.substring(1),16),a=d>>16&255,y=d>>8&255,D=d&255;return{r:a,g:y,b:D}}return(l,d)=>f.orders.length>0?(u(),E("div",ge,[c("h2",_e,w(f.title),1),c("div",fe,[t(le,{typeOrders:f.type,allOrders:f.orders,onFilter:g},null,8,["typeOrders","allOrders"])]),t(e(L),{class:"mb-20",value:C.value,tableStyle:"min-width: 50rem",filters:"filters",paginator:"",rows:5,dataKey:"id",filterDisplay:"row",loading:l.loading},{default:p(()=>[t(e(n),{headerClass:"!bg-primary-900",field:"DocNum",header:"Nota de venta"},{body:p(a=>[Y(" N° "+w(a.data.DocNum),1)]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"DocDate",header:"Fecha"}),t(e(n),{headerClass:"!bg-primary-900",field:"DocTime",header:"Hora"}),t(e(n),{headerClass:"!bg-primary-900",field:"Customer.CardName",header:"Cliente"}),t(e(n),{headerClass:"!bg-primary-900",field:"MethodShippingName",header:"Método entrega"},{body:p(a=>[t(e(R),{Tag:"",icon:"pi pi-shopping-cart",value:a.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"ResponsiblePickerName",header:"Picker"},{body:p(a=>[h(a.data,e(b).RESPONSIBLE_PICKER)?(u(),_(e(R),{key:0,icon:"pi pi-user",value:h(a.data,e(b).RESPONSIBLE_PICKER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):m("",!0)]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"ResponsibleReviewerName",header:"Revisor"},{body:p(a=>[h(a.data,e(b).RESPONSIBLE_REVIEWER)?(u(),_(e(R),{key:0,icon:"pi pi-user",value:h(a.data,e(b).RESPONSIBLE_REVIEWER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):m("",!0)]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"OrderStatusName",header:"Estado"},{body:p(a=>[t(e(R),{icon:"pi pi-circle-fill",value:a.data.OrderStatusName,style:ce({backgroundColor:a.data.OrderStatusColor,color:S(a.data.OrderStatusColor)}),class:"tag-font-method tag-radius"},null,8,["value","style"])]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"note",header:""},{body:p(a=>[a.data.OrderStatusId!=e(b).ORDER_STATUS_REVIEWER?(u(),_(e(x),{key:0,label:"Piekear",onClick:y=>O(a.data,e(b).RESPONSIBLE_PICKER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):m("",!0),a.data.OrderStatusId==e(b).ORDER_STATUS_REVIEWER?(u(),_(e(x),{key:1,label:"Revisar",onClick:y=>O(a.data,e(b).RESPONSIBLE_REVIEWER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):m("",!0)]),_:1})]),_:1},8,["value","loading"])])):m("",!0)}};const Ce={class:"px-8"},Re={key:0,class:"text-center",style:{color:"#259bd7"}},Se=c("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),ke=[Se],Ee={key:1},xe={class:"flex justify-between"},Ne=c("div",null,[c("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"}," Pickeo / Revisión ")],-1),Oe={key:2},Ie={class:"px-8"},Pe={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},we=c("i",{class:"pi pi-inbox !text-xl"},null,-1),De=c("div",{class:"flex align-center mb-2"},null,-1),Te={class:"mini-table mt-8"},$e={class:"mt-8 flex float-right"},Ae=c("div",{class:"space"},null,-1),Ke={__name:"PickupReview",setup(V){const{showToast:N}=oe.setup(),{showConfirm:f}=ie.setup(),C=ue(),g=i([]),O=i([]),h=i([]),S=i([]),k=i([]),l=i(!1),d=i(!0),a=i([]),y=i([]),D=i([]),H=i([]),K=new Set,B=new Set,J=new Set,T=i(!1),$=i(!1),{listOrdersHere:U,listOrdersPickup:z,listOrdersDelivery:X}=pe(C.$state),I=i([]),A=i([]),P=i([]);me(async()=>{try{await C.getOrdersPickerAndReviewer(),I.value=U.value,A.value=z.value,P.value=X.value,T.value=!0}catch(r){console.error("Error fetching orders:",r)}});const Z=r=>{I.value=M(U.value,r),A.value=M(z.value,r),P.value=M(P.value,r),console.log(I.value)};function M(r,s){return r.filter(v=>v.DocNum.toString().includes(s.value.toString())||v.Customer.CardName.toLowerCase().includes(s.value.toLowerCase()))}const W=r=>{$.value=!0,g.value=r.order,h.value=r.order.OrderItems,ee(r.type)},ee=async r=>{await C.assingResponsible({responsible:r},g.value.id)},j=()=>{$.value=!1},q=(r,s)=>{const v=J.add(r);if(r.id){const o=s==="complete"?K.add(r):K.delete(r);s==="complete"?(B.delete(r),a.value=Array.from(B)):H.value=r.problems,S.value[r.id]=s==="complete",k.value[r.id]=s!=="complete",l.value=s!=="complete",O.value=s!=="complete"?r:null,D.value=Array.from(v),d.value=D.value.length!==h.value.length,y.value=Array.from(o)}},te=({value:r,tempSelection:s})=>{r||(l.value=l.visibleReport,a.value=s)},ae=(r,s)=>{console.log(r,s);let v=B.add(r);a.value=Array.from(v),l.value=s.visibleReport},re=async()=>{if(await f())try{let s=y.value.length==h.value.length,v={orderId:g.value.id,action:s,responsible:"picker",orderItemsProblem:a.value??[]};(await C.processOrderAction(v)).status=="success"&&j(),N({status:data.status,message:data.message})}catch(s){s.response&&N({status:s.response.data.status,message:s.response.data.message})}else N({status:"info",message:"Proceso cancelado"})};return(r,s)=>{const v=ve("Toast");return u(),E("div",Ce,[T.value?m("",!0):(u(),E("div",Re,ke)),$.value?m("",!0):(u(),E("div",Ee,[c("div",xe,[Ne,t(de,{onSearch:Z})]),T.value&&I.value.length>0?(u(),_(Q,{key:0,title:"Aqui",type:e(b).METHOD_SHIPPING_HERE,orders:I.value,onAction:W},null,8,["type","orders"])):m("",!0),T.value&&A.value.length>0||P.value.length>0?(u(),_(Q,{key:1,title:"Retiro / Despacho",type:e(b).METHOD_SHIPPING_PICKUP_AND_DELIVERY,orders:[...A.value,...P.value],onAction:W},null,8,["type","orders"])):m("",!0)])),$.value?(u(),E("div",Oe,[c("div",Ie,[c("h1",Pe,[we,Y(" Nota de venta N° "+w(g.value.DocNum)+" ",1),t(e(R),{icon:"pi pi-shopping-cart",value:g.value.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),De,t(e(R),{icon:"pi pi-user",value:g.value.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),t(e(L),{tableStyle:"min-width: 50rem",filters:"filters",value:h.value},{default:p(()=>[t(e(n),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:p(o=>[c("p",null,w(o.data.qty)+" "+w(o.data.Quantity),1)]),_:1}),t(e(n),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),t(e(n),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),t(e(n),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),t(e(n),{headerClass:"!bg-primary-900",field:"id",header:""},{body:p(o=>[t(e(x),{icon:"pi pi-check-circle",onClick:F=>q(o.data,"complete"),label:"Completado",class:G({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5":S.value[o.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!S.value[o.data.id]}),outlined:!S.value[o.data.id]},null,8,["onClick","class","outlined"]),t(e(x),{icon:"pi pi-info-circle rotate-180",onClick:F=>q(o.data,"problem"),label:"Problema",class:G({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5":k.value[o.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5":!k.value[o.data.id]}),outlined:!k.value[o.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),c("div",Te,[a.value.length>0?(u(),_(e(L),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:a.value,class:"teble-probelm"},{default:p(()=>[t(e(n),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),t(e(n),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),t(e(n),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:p(o=>[(u(!0),E(be,null,he(o.data.problems,(F,se)=>(u(),_(e(R),{key:se,value:F.title,rounded:"",class:"mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):m("",!0)]),c("div",$e,[t(e(x),{onClick:j,label:"Cancelar",class:"mr-4 !py-1.5 !px-10 p-button-outlined float-right !border-primary-900 !text-primary-900"}),t(e(x),{onClick:re,label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:d.value},null,8,["disabled"])])]),Ae,t(ne,{visible:l.value,"onUpdate:visible":s[0]||(s[0]=o=>l.value=o),product:O.value,problemsProduct:H.value,typeProblems:"picker-revisor",onSelectionChange:ae,onVisibleReport:te},null,8,["visible","product","problemsProduct"]),t(v),t(e(ye))])):m("",!0)])}}};export{Ke as default};
