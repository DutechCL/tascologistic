import{s as u,a as I,b as W}from"./tag.esm-61ea5c3c.js";import{C as ue,a as ce,_ as pe}from"./DialogReportProblem-78c47047.js";import{u as me}from"./OrdersApiService-8dda9cf1.js";import{e as n,l as te,o as c,c as N,h as d,t as L,a as r,w as v,u as e,i as j,m as _,v as p,n as ve,s as T,x as he,k as be,r as ge,F as X,j as Z,p as ye,z as fe}from"./index-bab20c0d.js";import{_ as _e,c as h,T as Ce}from"./FilterMultiSelect-9ccc00e6.js";import"./index.esm-96b319e8.js";import"./index.esm-3063288a.js";const ke={key:0},Re={class:"mb-4 text-primary-900 font-inter font-semibold text-xl"},Ee={class:"flex"},ee={__name:"DataTableOrdersPickerReview",props:{title:String,type:String,orders:Array},setup(Q,{emit:y}){const C=Q,b=n(C.orders);te(()=>C.orders,o=>{b.value=o});const k=o=>{b.value=o.orders},D=(o,i)=>{let a=m(o,i)!==void 0;y("action",{order:o,type:i,responsible:a})},m=(o,i)=>{var a;return(a=o.Responsibles.find(f=>f.pivot.task==i))==null?void 0:a.name};function x(o){const i=R(o);return(.299*i.r+.587*i.g+.114*i.b)/255>.5?"#000000":"#FFFFFF"}function R(o){const i=parseInt(o.substring(1),16),a=i>>16&255,f=i>>8&255,w=i&255;return{r:a,g:f,b:w}}return(o,i)=>C.orders.length>0?(c(),N("div",ke,[d("h2",Re,L(C.title),1),d("div",Ee,[r(_e,{typeOrders:C.type,allOrders:C.orders,onFilter:k},null,8,["typeOrders","allOrders"])]),r(e(W),{class:"mb-20",value:b.value,tableStyle:"min-width: 50rem",filters:"filters",paginator:"",rows:5,dataKey:"id",filterDisplay:"row",loading:o.loading,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords}"},{default:v(()=>[r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocNum",header:"Nota de venta"},{body:v(a=>[j(" N° "+L(a.data.DocNum),1)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocDate",header:"Fecha"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"DocTime",header:"Hora"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"Customer.CardName",header:"Cliente"}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"MethodShippingName",header:"Método entrega"},{body:v(a=>[r(e(I),{Tag:"",icon:"pi pi-shopping-cart",value:a.data.MethodShippingName,rounded:"",class:"tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ResponsiblePickerName",header:"Picker"},{body:v(a=>[m(a.data,e(h).RESPONSIBLE_PICKER)?(c(),_(e(I),{key:0,icon:"pi pi-user",value:m(a.data,e(h).RESPONSIBLE_PICKER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):p("",!0)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ResponsibleReviewerName",header:"Revisor"},{body:v(a=>[m(a.data,e(h).RESPONSIBLE_REVIEWER)?(c(),_(e(I),{key:0,icon:"pi pi-user",value:m(a.data,e(h).RESPONSIBLE_REVIEWER),class:"tag-rounded-blue tag-font-method tag-radius"},null,8,["value"])):p("",!0)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",sortable:"",field:"OrderStatusName",header:"Estado"},{body:v(a=>[r(e(I),{icon:"pi pi-circle-fill",value:a.data.OrderStatusName,style:ve({backgroundColor:a.data.OrderStatusColor,color:x(a.data.OrderStatusColor)}),class:"tag-font-method tag-radius"},null,8,["value","style"])]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"note",header:""},{body:v(a=>[a.data.OrderStatusId!=e(h).ORDER_STATUS_REVIEWER?(c(),_(e(T),{key:0,label:"Piekear",onClick:f=>D(a.data,e(h).RESPONSIBLE_PICKER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):p("",!0),a.data.OrderStatusId==e(h).ORDER_STATUS_REVIEWER?(c(),_(e(T),{key:1,label:"Revisar",onClick:f=>D(a.data,e(h).RESPONSIBLE_REVIEWER),class:"p-button p-component p-button-outlined !py-1.5 !border-primary-900 !text-primary-900"},null,8,["onClick"])):p("",!0)]),_:1})]),_:1},8,["value","loading"])])):p("",!0)}};const Se={class:"px-8"},xe={key:0,class:"text-center",style:{color:"#259bd7"}},Pe=d("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1),Oe=[Pe],Ne={key:1},Ie={class:"flex justify-between"},we=d("i",{class:"pi pi-refresh"},null,-1),Te=[we],De={key:2},Ae={class:"px-8"},Le={class:"mb-1 text-primary-900 font-inter font-semibold text-xl"},$e=d("i",{class:"pi pi-inbox !text-xl"},null,-1),Be=d("div",{class:"flex align-center mb-2"},null,-1),Fe={class:"mini-table mt-8"},Me={class:"mt-8 flex float-right"},Ve=d("div",{class:"space"},null,-1),Ue={key:0,style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},He=d("h1",{class:"align-center font-inter font-semibold mb-4 text-2xl text-center text-primary-900"}," No se han encontrado ordenes ",-1),Ke=[He],Je={__name:"PickupReview",setup(Q){const{showToast:y}=Ce.setup(),{showConfirm:C}=ue.setup(),b=me(),k=n([]),D=n([]),m=n([]),x=n([]),R=n([]),o=n(!1),i=n(!0),a=n([]),f=n([]),w=n([]),M=n([]),V=new Set,$=new Set,B=new Set,A=n(!1),F=n(!1),G=n(""),{listOrdersHere:U,listOrdersPickup:H,listOrdersDelivery:q}=he(b.$state),P=n([]),O=n([]),E=n([]),ae=async()=>{await b.getOrdersPickerAndReviewer(),y({status:"success",message:"Ordenes actualizadas",time:3e3})};te(()=>b.orders,t=>{P.value=U.value,O.value=H.value,E.value=q.value}),be(async()=>{try{await b.getOrdersPickerAndReviewer(),P.value=U.value,O.value=H.value,E.value=q.value,A.value=!0}catch(t){console.error("Error fetching orders:",t)}});const se=t=>{P.value=K(U.value,t),O.value=K(H.value,t),E.value=K(E.value,t)};function K(t,s){return t.filter(g=>g.DocNum.toString().includes(s.value.toString())||g.Customer.CardName.toLowerCase().includes(s.value.toLowerCase()))}const Y=t=>{F.value=!0,k.value=t.order,m.value=t.order.OrderItems,G.value=t.type,t.responsible||ie(t.type)},z=()=>{F.value=!1,re()},re=()=>{B.clear(),V.clear(),$.clear(),i.value=!0,a.value=[],M.value=[],m.value.forEach(t=>{R.value[t.id]=!1,x.value[t.id]=!1})},J=(t,s)=>{const g=s==="complete"?B.add(t):B.delete(t);if(t.id){const l=s==="complete"?V.add(t):V.delete(t);s==="complete"?(R.value[t.id]=!1,$.delete(t),a.value=Array.from($)):M.value=t.problems,x.value[t.id]=s==="complete",o.value=s!=="complete",D.value=s!=="complete"?t:null,w.value=Array.from(g),i.value=w.value.length!==m.value.length,f.value=Array.from(l)}},le=({value:t,tempSelection:s})=>{t||(o.value=o.visibleReport,a.value=s)},oe=(t,s)=>{t.problems=s.listProblems;let g=B.add(t);w.value=Array.from(g);let l=$.add(t);a.value=Array.from(l),i.value=w.value.length!==m.value.length,a.value.length>0&&a.value.forEach(S=>{R.value[S.id]=!0}),o.value=s.visibleReport},ie=async t=>{try{let s=await b.assingResponsible({responsible:t},k.value.id);s.status=="success"?y({status:s.status,message:s.message,time:3e3}):(y({status:"info",message:s.message,time:3e3}),setTimeout(()=>{z()},3e3))}catch(s){s.response&&y({status:s.response.response.status,message:s.response.response.message,time:5e3})}},ne=async()=>{if(i.value=!0,await C())try{let s=f.value.length==m.value.length,g={orderId:k.value.id,action:s,responsible:G.value,orderItemsProblem:a.value??[]},l=await b.processOrderAction(g);l.status=="success"&&z(),console.log(l),y({status:l.status,message:l.message})}catch(s){s.response&&y({status:s.response.response.status,message:s.response.response.message})}else i.value=!1,y({status:"info",message:"Proceso cancelado"})};return(t,s)=>{const g=ge("Toast");return c(),N(X,null,[d("div",Se,[A.value?p("",!0):(c(),N("div",xe,Oe)),F.value?p("",!0):(c(),N("div",Ne,[d("div",Ie,[d("div",null,[d("h1",{class:"mb-2 text-primary-900 font-inter font-semibold text-2xl"},[j(" Pickeo / Revisión "),d("a",{style:{cursor:"pointer"},onClick:ae},Te)])]),r(pe,{onSearch:se})]),A.value&&P.value.length>0?(c(),_(ee,{key:0,title:"Aqui",type:e(h).METHOD_SHIPPING_HERE,orders:P.value,onAction:Y},null,8,["type","orders"])):p("",!0),A.value&&O.value.length>0||E.value.length>0?(c(),_(ee,{key:1,title:"Retiro / Despacho",type:e(h).METHOD_SHIPPING_PICKUP_AND_DELIVERY,orders:[...O.value,...E.value],onAction:Y},null,8,["type","orders"])):p("",!0)])),F.value?(c(),N("div",De,[d("div",Ae,[d("h1",Le,[$e,j(" Nota de venta N° "+L(k.value.DocNum)+" ",1),r(e(I),{icon:"pi pi-shopping-cart",value:k.value.MethodShippingName,class:"ml-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"])]),Be,r(e(I),{icon:"pi pi-user",value:k.value.Customer.CardName,class:"tag-radius tag-rounded-blue tag-font-method mb-5"},null,8,["value"]),r(e(W),{tableStyle:"min-width: 50rem",filters:"filters",value:m.value},{default:v(()=>[r(e(u),{headerClass:"!bg-primary-900",field:"Quantity",header:"Cantidad"},{body:v(l=>[d("p",null,L(l.data.Quantity)+" "+L(l.data.Quantity>1?"Unidades":"Unidad"),1)]),_:1}),r(e(u),{headerClass:"!bg-primary-900",field:"ItemCode",header:"SKU"}),r(e(u),{headerClass:"!bg-primary-900",field:"ItemDescription",header:"Producto"}),r(e(u),{headerClass:"!bg-primary-900",field:"ubication",header:"Ubicación"}),r(e(u),{headerClass:"!bg-primary-900",field:"id",header:""},{body:v(l=>[r(e(T),{icon:"pi pi-check-circle",onClick:S=>J(l.data,"complete"),label:"Completado",class:Z({"!py-2.5 !bg-green-300 !border-green-300 !text-white !mr-5 p-buttons-picker":x.value[l.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!x.value[l.data.id]}),outlined:!x.value[l.data.id]},null,8,["onClick","class","outlined"]),r(e(T),{icon:"pi pi-info-circle rotate-180",onClick:S=>J(l.data,"problem"),label:"Problema",class:Z({"!py-2.5 !bg-red-300 !border-red-300 !text-white !mr-5 p-buttons-picker":R.value[l.data.id],"!py-2.5 !border-primary-900 !text-primary-900 mr-5 p-buttons-picker":!R.value[l.data.id]}),outlined:!R.value[l.data.id]},null,8,["onClick","class","outlined"])]),_:1})]),_:1},8,["value"]),d("div",Fe,[a.value.length>0?(c(),_(e(W),{key:0,tableStyle:"min-width: 50rem",filters:"filters",value:a.value,class:"teble-probelm"},{default:v(()=>[r(e(u),{headerClass:"!bg-secundary-300",field:"ItemCode",header:"SKU"}),r(e(u),{headerClass:"!bg-secundary-300",field:"ItemDescription",header:"Producto"}),r(e(u),{headerClass:"!bg-secundary-300",field:"problems",header:"Problema"},{body:v(l=>[(c(!0),N(X,null,ye(l.data.problems,(S,de)=>(c(),_(e(I),{key:de,value:(S==null?void 0:S.other)||S.title,rounded:"",class:"my-2 mr-3 tag-radius tag-rounded-blue tag-font-method"},null,8,["value"]))),128))]),_:1})]),_:1},8,["value"])):p("",!0)]),d("div",Me,[r(e(T),{onClick:z,label:"Cancelar",class:"mr-4 !py-1.5 !px-10 p-button-outlined float-right !border-primary-900 !text-primary-900"}),r(e(T),{onClick:s[0]||(s[0]=l=>ne()),label:"Finalizar pedido",class:"!py-1.5 !border-none !px-10 !bg-primary-900 float-right",disabled:i.value},null,8,["disabled"])])]),Ve,A.value&&O.value.length>0||E.value.length>0||P.value.length>0?(c(),_(ce,{key:0,visible:o.value,"onUpdate:visible":s[1]||(s[1]=l=>o.value=l),product:D.value,problemsProduct:M.value,typeProblems:e(h).RESPONSIBLE_PICKER_AND_REVIEWER,onSelectionChange:oe,onVisible:le},null,8,["visible","product","problemsProduct","typeProblems"])):p("",!0)])):p("",!0)]),P.value.length===0&&O.value.length===0&&E.value?(c(),N("div",Ue,Ke)):p("",!0),r(g),r(e(fe))],64)}}};export{Je as default};
